processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:05<00:16,  2.76s/it] 38%|███▊      | 3/8 [00:10<00:19,  3.89s/it] 50%|█████     | 4/8 [00:16<00:17,  4.48s/it] 62%|██████▎   | 5/8 [00:21<00:14,  4.77s/it] 75%|███████▌  | 6/8 [00:27<00:09,  4.99s/it] 88%|████████▊ | 7/8 [00:32<00:05,  5.14s/it]100%|██████████| 8/8 [00:38<00:00,  5.22s/it]100%|██████████| 8/8 [00:38<00:00,  4.76s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.91it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  5.21it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.20it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.85it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Your device support faster inference by passing bf16=True in "AutoModelForCausalLM.from_pretrained".
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 67 images, 67 texts in 89.66s
Loading checkpoint shards:   0%|          | 0/10 [00:00<?, ?it/s]Loading checkpoint shards:  10%|█         | 1/10 [00:00<00:08,  1.08it/s]Loading checkpoint shards:  20%|██        | 2/10 [00:03<00:13,  1.63s/it]Loading checkpoint shards:  30%|███       | 3/10 [00:04<00:10,  1.48s/it]Loading checkpoint shards:  40%|████      | 4/10 [00:05<00:06,  1.16s/it]Loading checkpoint shards:  50%|█████     | 5/10 [00:05<00:04,  1.02it/s]Loading checkpoint shards:  60%|██████    | 6/10 [00:06<00:03,  1.15it/s]Loading checkpoint shards:  70%|███████   | 7/10 [00:06<00:02,  1.25it/s]Loading checkpoint shards:  80%|████████  | 8/10 [00:08<00:01,  1.04it/s]Loading checkpoint shards:  90%|█████████ | 9/10 [00:09<00:01,  1.13s/it]Loading checkpoint shards: 100%|██████████| 10/10 [00:10<00:00,  1.00s/it]Loading checkpoint shards: 100%|██████████| 10/10 [00:10<00:00,  1.05s/it]
generating response:   0%|          | 0/67 [00:00<?, ?it/s]generating response:   1%|▏         | 1/67 [00:03<03:26,  3.13s/it]generating response:   3%|▎         | 2/67 [00:11<06:39,  6.15s/it]generating response:   4%|▍         | 3/67 [00:17<06:25,  6.02s/it]generating response:   6%|▌         | 4/67 [00:22<05:47,  5.52s/it]generating response:   7%|▋         | 5/67 [00:30<06:48,  6.60s/it]generating response:   9%|▉         | 6/67 [00:40<07:45,  7.63s/it]generating response:  10%|█         | 7/67 [00:47<07:33,  7.55s/it]generating response:  12%|█▏        | 8/67 [00:50<05:54,  6.00s/it]generating response:  13%|█▎        | 9/67 [01:02<07:48,  8.07s/it]generating response:  15%|█▍        | 10/67 [01:05<06:08,  6.46s/it]generating response:  16%|█▋        | 11/67 [01:09<05:13,  5.61s/it]generating response:  18%|█▊        | 12/67 [01:11<04:10,  4.55s/it]generating response:  19%|█▉        | 13/67 [01:25<06:47,  7.55s/it]generating response:  21%|██        | 14/67 [01:28<05:15,  5.95s/it]generating response:  22%|██▏       | 15/67 [01:31<04:20,  5.02s/it]generating response:  24%|██▍       | 16/67 [01:33<03:32,  4.17s/it]generating response:  25%|██▌       | 17/67 [01:36<03:07,  3.76s/it]generating response:  27%|██▋       | 18/67 [01:44<04:16,  5.24s/it]generating response:  28%|██▊       | 19/67 [01:52<04:47,  5.99s/it]generating response:  30%|██▉       | 20/67 [02:00<05:12,  6.65s/it]generating response:  31%|███▏      | 21/67 [02:05<04:42,  6.13s/it]generating response:  33%|███▎      | 22/67 [02:14<05:14,  6.99s/it]generating response:  34%|███▍      | 23/67 [02:24<05:40,  7.73s/it]generating response:  36%|███▌      | 24/67 [02:29<04:58,  6.94s/it]generating response:  37%|███▋      | 25/67 [02:37<05:10,  7.38s/it]generating response:  39%|███▉      | 26/67 [02:45<05:10,  7.58s/it]generating response:  40%|████      | 27/67 [02:53<05:06,  7.67s/it]generating response:  42%|████▏     | 28/67 [03:00<04:50,  7.45s/it]generating response:  43%|████▎     | 29/67 [03:06<04:32,  7.17s/it]generating response:  45%|████▍     | 30/67 [03:14<04:33,  7.40s/it]generating response:  46%|████▋     | 31/67 [03:20<04:02,  6.73s/it]generating response:  48%|████▊     | 32/67 [03:25<03:44,  6.40s/it]generating response:  49%|████▉     | 33/67 [03:32<03:45,  6.65s/it]generating response:  51%|█████     | 34/67 [03:44<04:27,  8.11s/it]generating response:  52%|█████▏    | 35/67 [03:47<03:30,  6.58s/it]generating response:  54%|█████▎    | 36/67 [03:51<03:03,  5.93s/it]generating response:  55%|█████▌    | 37/67 [03:55<02:34,  5.15s/it]generating response:  57%|█████▋    | 38/67 [04:04<03:01,  6.25s/it]generating response:  58%|█████▊    | 39/67 [04:06<02:23,  5.12s/it]generating response:  60%|█████▉    | 40/67 [04:08<01:54,  4.26s/it]generating response:  61%|██████    | 41/67 [04:13<01:53,  4.37s/it]generating response:  63%|██████▎   | 42/67 [04:16<01:38,  3.93s/it]generating response:  64%|██████▍   | 43/67 [04:25<02:12,  5.51s/it]generating response:  66%|██████▌   | 44/67 [04:28<01:48,  4.73s/it]generating response:  67%|██████▋   | 45/67 [04:31<01:31,  4.17s/it]generating response:  69%|██████▊   | 46/67 [04:39<01:53,  5.41s/it]generating response:  70%|███████   | 47/67 [04:48<02:08,  6.45s/it]generating response:  72%|███████▏  | 48/67 [04:50<01:40,  5.29s/it]generating response:  73%|███████▎  | 49/67 [04:53<01:17,  4.33s/it]generating response:  75%|███████▍  | 50/67 [04:55<01:02,  3.65s/it]generating response:  76%|███████▌  | 51/67 [05:00<01:04,  4.05s/it]generating response:  78%|███████▊  | 52/67 [05:04<01:03,  4.26s/it]generating response:  79%|███████▉  | 53/67 [05:11<01:10,  5.06s/it]generating response:  81%|████████  | 54/67 [05:19<01:16,  5.86s/it]generating response:  82%|████████▏ | 55/67 [05:22<00:59,  4.92s/it]generating response:  84%|████████▎ | 56/67 [05:28<00:56,  5.18s/it]generating response:  85%|████████▌ | 57/67 [05:35<00:57,  5.73s/it]generating response:  87%|████████▋ | 58/67 [05:44<01:02,  6.94s/it]generating response:  88%|████████▊ | 59/67 [05:53<01:00,  7.59s/it]generating response:  90%|████████▉ | 60/67 [06:05<01:01,  8.73s/it]generating response:  91%|█████████ | 61/67 [06:22<01:07, 11.27s/it]generating response:  93%|█████████▎| 62/67 [06:35<00:58, 11.75s/it]generating response:  94%|█████████▍| 63/67 [06:52<00:53, 13.38s/it]generating response:  96%|█████████▌| 64/67 [07:01<00:35, 11.92s/it]generating response:  97%|█████████▋| 65/67 [07:09<00:21, 11.00s/it]generating response:  99%|█████████▊| 66/67 [07:21<00:11, 11.18s/it]generating response: 100%|██████████| 67/67 [07:34<00:00, 11.59s/it]generating response: 100%|██████████| 67/67 [07:34<00:00,  6.78s/it]
generation part takes 480.44s
Full generation completed in 570.18s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:05<00:16,  2.75s/it] 38%|███▊      | 3/8 [00:10<00:19,  3.89s/it] 50%|█████     | 4/8 [00:16<00:17,  4.47s/it] 62%|██████▎   | 5/8 [00:21<00:14,  4.76s/it] 75%|███████▌  | 6/8 [00:27<00:09,  4.96s/it] 88%|████████▊ | 7/8 [00:32<00:05,  5.12s/it]100%|██████████| 8/8 [00:37<00:00,  5.20s/it]100%|██████████| 8/8 [00:37<00:00,  4.74s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  5.04it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.41it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.95it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.60it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
You are using the default legacy behaviour of the <class 'transformers.models.llama.tokenization_llama.LlamaTokenizer'>. This is expected, and simply means that the `legacy` (previous) behavior will be used so nothing changes for you. If you want to use the new behaviour, set `legacy=False`. This should only be set if you understand what it means, and thoroughly read the reason why this was added as explained in https://github.com/huggingface/transformers/pull/24565
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 67 images, 67 texts in 79.51s
Loading MiniGPT-4 models...Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:44<00:44, 44.77s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 24.55s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:55<00:00, 27.59s/it]
Loading Q-Former
Loading Q-Former Done
Load MiniGPT-4 Checkpoint: /home/xuyue/QXYtemp/MLM/minigpt4/prerained_minigpt4_7b.pth
Done
generating response:   0%|          | 0/67 [00:00<?, ?it/s]generating response:   1%|▏         | 1/67 [00:37<41:45, 37.96s/it]generating response:   3%|▎         | 2/67 [01:15<40:36, 37.49s/it]generating response:   4%|▍         | 3/67 [01:52<40:08, 37.63s/it]generating response:   6%|▌         | 4/67 [02:29<39:10, 37.32s/it]generating response:   7%|▋         | 5/67 [03:06<38:31, 37.29s/it]generating response:   9%|▉         | 6/67 [03:44<38:02, 37.41s/it]generating response:  10%|█         | 7/67 [04:22<37:37, 37.62s/it]generating response:  12%|█▏        | 8/67 [04:59<36:44, 37.36s/it]generating response:  13%|█▎        | 9/67 [05:37<36:16, 37.52s/it]generating response:  15%|█▍        | 10/67 [06:14<35:26, 37.30s/it]generating response:  16%|█▋        | 11/67 [06:50<34:40, 37.15s/it]generating response:  18%|█▊        | 12/67 [07:27<33:55, 37.02s/it]generating response:  19%|█▉        | 13/67 [08:04<33:22, 37.09s/it]generating response:  21%|██        | 14/67 [08:41<32:39, 36.97s/it]generating response:  22%|██▏       | 15/67 [09:17<31:48, 36.71s/it]generating response:  24%|██▍       | 16/67 [09:54<31:15, 36.77s/it]generating response:  25%|██▌       | 17/67 [10:31<30:40, 36.82s/it]generating response:  27%|██▋       | 18/67 [11:09<30:16, 37.08s/it]generating response:  28%|██▊       | 19/67 [11:46<29:37, 37.04s/it]generating response:  30%|██▉       | 20/67 [12:22<28:52, 36.85s/it]generating response:  31%|███▏      | 21/67 [13:00<28:24, 37.06s/it]generating response:  33%|███▎      | 22/67 [13:37<27:56, 37.25s/it]generating response:  34%|███▍      | 23/67 [14:15<27:19, 37.25s/it]generating response:  36%|███▌      | 24/67 [14:52<26:42, 37.26s/it]generating response:  37%|███▋      | 25/67 [15:29<26:08, 37.35s/it]generating response:  39%|███▉      | 26/67 [16:06<25:25, 37.21s/it]generating response:  40%|████      | 27/67 [16:44<24:48, 37.20s/it]generating response:  42%|████▏     | 28/67 [17:21<24:09, 37.16s/it]generating response:  43%|████▎     | 29/67 [17:58<23:34, 37.21s/it]generating response:  45%|████▍     | 30/67 [18:36<23:03, 37.38s/it]generating response:  46%|████▋     | 31/67 [19:13<22:25, 37.37s/it]generating response:  48%|████▊     | 32/67 [19:50<21:43, 37.25s/it]generating response:  49%|████▉     | 33/67 [20:27<21:04, 37.20s/it]generating response:  51%|█████     | 34/67 [21:05<20:29, 37.27s/it]generating response:  52%|█████▏    | 35/67 [21:42<19:54, 37.33s/it]generating response:  54%|█████▎    | 36/67 [22:20<19:19, 37.39s/it]generating response:  55%|█████▌    | 37/67 [22:57<18:42, 37.42s/it]generating response:  57%|█████▋    | 38/67 [23:34<18:02, 37.34s/it]generating response:  58%|█████▊    | 39/67 [24:11<17:24, 37.32s/it]generating response:  60%|█████▉    | 40/67 [24:49<16:52, 37.49s/it]generating response:  61%|██████    | 41/67 [25:27<16:14, 37.47s/it]generating response:  63%|██████▎   | 42/67 [26:04<15:36, 37.46s/it]generating response:  64%|██████▍   | 43/67 [26:42<15:03, 37.65s/it]generating response:  66%|██████▌   | 44/67 [27:20<14:29, 37.80s/it]generating response:  67%|██████▋   | 45/67 [27:57<13:46, 37.55s/it]generating response:  69%|██████▊   | 46/67 [28:34<13:05, 37.38s/it]generating response:  70%|███████   | 47/67 [29:12<12:26, 37.33s/it]generating response:  72%|███████▏  | 48/67 [29:50<11:56, 37.73s/it]generating response:  73%|███████▎  | 49/67 [30:28<11:17, 37.66s/it]generating response:  75%|███████▍  | 50/67 [31:05<10:37, 37.51s/it]generating response:  76%|███████▌  | 51/67 [31:43<10:00, 37.54s/it]generating response:  78%|███████▊  | 52/67 [32:20<09:21, 37.44s/it]generating response:  79%|███████▉  | 53/67 [32:57<08:44, 37.46s/it]generating response:  81%|████████  | 54/67 [33:35<08:08, 37.57s/it]generating response:  82%|████████▏ | 55/67 [34:12<07:29, 37.49s/it]generating response:  84%|████████▎ | 56/67 [34:50<06:52, 37.48s/it]generating response:  85%|████████▌ | 57/67 [35:27<06:14, 37.44s/it]generating response:  87%|████████▋ | 58/67 [36:04<05:35, 37.31s/it]generating response:  88%|████████▊ | 59/67 [36:42<04:59, 37.39s/it]generating response:  90%|████████▉ | 60/67 [37:19<04:21, 37.32s/it]generating response:  91%|█████████ | 61/67 [37:58<03:46, 37.83s/it]generating response:  93%|█████████▎| 62/67 [38:37<03:11, 38.32s/it]generating response:  94%|█████████▍| 63/67 [39:15<02:32, 38.05s/it]generating response:  96%|█████████▌| 64/67 [39:53<01:54, 38.07s/it]generating response:  97%|█████████▋| 65/67 [40:30<01:15, 37.84s/it]generating response:  99%|█████████▊| 66/67 [41:08<00:37, 37.82s/it]generating response: 100%|██████████| 67/67 [41:46<00:00, 37.93s/it]generating response: 100%|██████████| 67/67 [41:46<00:00, 37.41s/it]
generation part takes 2591.14s
Full generation completed in 2670.68s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:06<00:19,  3.28s/it] 38%|███▊      | 3/8 [00:12<00:22,  4.59s/it] 50%|█████     | 4/8 [00:19<00:21,  5.31s/it] 62%|██████▎   | 5/8 [00:26<00:17,  5.74s/it] 75%|███████▌  | 6/8 [00:32<00:11,  6.00s/it] 88%|████████▊ | 7/8 [00:39<00:06,  6.17s/it]100%|██████████| 8/8 [00:45<00:00,  6.24s/it]100%|██████████| 8/8 [00:45<00:00,  5.69s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  5.12it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.50it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  7.14it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.76it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 76 images, 76 texts in 88.59s
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:11<00:34, 11.55s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:21<00:21, 10.59s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:32<00:10, 10.68s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:33<00:00,  7.07s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:33<00:00,  8.45s/it]
generating response:   0%|          | 0/76 [00:00<?, ?it/s]generating response:   1%|▏         | 1/76 [00:00<00:26,  2.82it/s]generating response:   3%|▎         | 2/76 [00:00<00:31,  2.35it/s]generating response:   4%|▍         | 3/76 [00:01<00:27,  2.64it/s]generating response:   5%|▌         | 4/76 [00:16<07:25,  6.19s/it]generating response:   7%|▋         | 5/76 [00:16<04:49,  4.08s/it]generating response:   8%|▊         | 6/76 [00:16<03:17,  2.82s/it]generating response:   9%|▉         | 7/76 [00:17<02:19,  2.02s/it]generating response:  11%|█         | 8/76 [00:17<01:41,  1.49s/it]generating response:  12%|█▏        | 9/76 [00:33<06:29,  5.81s/it]generating response:  13%|█▎        | 10/76 [00:33<04:31,  4.12s/it]generating response:  14%|█▍        | 11/76 [00:33<03:10,  2.93s/it]generating response:  16%|█▌        | 12/76 [00:33<02:14,  2.11s/it]generating response:  17%|█▋        | 13/76 [00:34<01:36,  1.54s/it]generating response:  18%|█▊        | 14/76 [00:34<01:11,  1.16s/it]generating response:  20%|█▉        | 15/76 [00:34<00:56,  1.09it/s]generating response:  21%|██        | 16/76 [00:34<00:42,  1.41it/s]generating response:  22%|██▏       | 17/76 [00:35<00:33,  1.77it/s]generating response:  24%|██▎       | 18/76 [00:35<00:26,  2.16it/s]generating response:  25%|██▌       | 19/76 [00:35<00:22,  2.55it/s]generating response:  26%|██▋       | 20/76 [00:35<00:20,  2.80it/s]generating response:  28%|██▊       | 21/76 [00:36<00:21,  2.55it/s]generating response:  29%|██▉       | 22/76 [00:36<00:18,  2.92it/s]generating response:  30%|███       | 23/76 [00:36<00:16,  3.25it/s]generating response:  32%|███▏      | 24/76 [00:36<00:14,  3.53it/s]generating response:  33%|███▎      | 25/76 [00:37<00:13,  3.75it/s]generating response:  34%|███▍      | 26/76 [00:37<00:13,  3.75it/s]generating response:  36%|███▌      | 27/76 [00:37<00:12,  3.93it/s]generating response:  37%|███▋      | 28/76 [00:38<00:14,  3.28it/s]generating response:  38%|███▊      | 29/76 [00:38<00:14,  3.22it/s]generating response:  39%|███▉      | 30/76 [00:38<00:15,  3.03it/s]generating response:  41%|████      | 31/76 [00:39<00:16,  2.80it/s]generating response:  42%|████▏     | 32/76 [00:39<00:13,  3.15it/s]generating response:  43%|████▎     | 33/76 [00:39<00:12,  3.44it/s]generating response:  45%|████▍     | 34/76 [00:39<00:11,  3.69it/s]generating response:  46%|████▌     | 35/76 [00:40<00:10,  3.88it/s]generating response:  47%|████▋     | 36/76 [00:40<00:09,  4.03it/s]generating response:  49%|████▊     | 37/76 [00:40<00:09,  4.13it/s]generating response:  50%|█████     | 38/76 [00:40<00:09,  4.21it/s]generating response:  51%|█████▏    | 39/76 [00:41<00:08,  4.27it/s]generating response:  53%|█████▎    | 40/76 [00:41<00:08,  4.32it/s]generating response:  54%|█████▍    | 41/76 [00:41<00:08,  4.35it/s]generating response:  55%|█████▌    | 42/76 [00:41<00:09,  3.48it/s]generating response:  57%|█████▋    | 43/76 [00:42<00:08,  3.71it/s]generating response:  58%|█████▊    | 44/76 [00:42<00:09,  3.50it/s]generating response:  59%|█████▉    | 45/76 [00:42<00:08,  3.74it/s]generating response:  61%|██████    | 46/76 [00:42<00:07,  3.93it/s]generating response:  62%|██████▏   | 47/76 [00:43<00:07,  4.06it/s]generating response:  63%|██████▎   | 48/76 [00:43<00:06,  4.17it/s]generating response:  64%|██████▍   | 49/76 [00:43<00:06,  4.24it/s]generating response:  66%|██████▌   | 50/76 [00:43<00:06,  4.30it/s]generating response:  67%|██████▋   | 51/76 [00:44<00:05,  4.33it/s]generating response:  68%|██████▊   | 52/76 [00:44<00:05,  4.10it/s]generating response:  70%|██████▉   | 53/76 [00:59<01:48,  4.70s/it]generating response:  71%|███████   | 54/76 [00:59<01:13,  3.36s/it]generating response:  72%|███████▏  | 55/76 [00:59<00:50,  2.42s/it]generating response:  74%|███████▎  | 56/76 [01:00<00:35,  1.76s/it]generating response:  75%|███████▌  | 57/76 [01:00<00:24,  1.30s/it]generating response:  76%|███████▋  | 58/76 [01:00<00:17,  1.02it/s]generating response:  78%|███████▊  | 59/76 [01:00<00:13,  1.26it/s]generating response:  79%|███████▉  | 60/76 [01:01<00:10,  1.60it/s]generating response:  80%|████████  | 61/76 [01:01<00:07,  1.98it/s]generating response:  82%|████████▏ | 62/76 [01:01<00:05,  2.37it/s]generating response:  83%|████████▎ | 63/76 [01:01<00:04,  2.75it/s]generating response:  84%|████████▍ | 64/76 [01:02<00:03,  3.10it/s]generating response:  86%|████████▌ | 65/76 [01:02<00:03,  2.96it/s]generating response:  87%|████████▋ | 66/76 [01:17<00:47,  4.77s/it]generating response:  88%|████████▊ | 67/76 [01:18<00:31,  3.47s/it]generating response:  89%|████████▉ | 68/76 [01:18<00:20,  2.54s/it]generating response:  91%|█████████ | 69/76 [01:18<00:13,  1.91s/it]generating response:  92%|█████████▏| 70/76 [01:19<00:08,  1.45s/it]generating response:  93%|█████████▎| 71/76 [01:19<00:05,  1.10s/it]generating response:  95%|█████████▍| 72/76 [01:19<00:03,  1.20it/s]generating response:  96%|█████████▌| 73/76 [01:20<00:02,  1.40it/s]generating response:  97%|█████████▋| 74/76 [01:20<00:01,  1.76it/s]generating response:  99%|█████████▊| 75/76 [01:20<00:00,  2.15it/s]generating response: 100%|██████████| 76/76 [01:20<00:00,  2.54it/s]generating response: 100%|██████████| 76/76 [01:20<00:00,  1.06s/it]
generation part takes 129.28s
Full generation completed in 217.93s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:06<00:19,  3.19s/it] 38%|███▊      | 3/8 [00:12<00:22,  4.51s/it] 50%|█████     | 4/8 [00:19<00:20,  5.19s/it] 62%|██████▎   | 5/8 [00:25<00:17,  5.73s/it] 75%|███████▌  | 6/8 [00:32<00:11,  5.95s/it] 88%|████████▊ | 7/8 [00:38<00:06,  6.10s/it]100%|██████████| 8/8 [00:45<00:00,  6.21s/it]100%|██████████| 8/8 [00:45<00:00,  5.64s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.52it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.04it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.72it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.29it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 75 images, 75 texts in 92.74s
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:04,  1.62s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:03<00:03,  1.64s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:05<00:01,  1.68s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.20s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:05<00:00,  1.37s/it]
generating response:   0%|          | 0/75 [00:00<?, ?it/s]generating response:   1%|▏         | 1/75 [00:00<00:22,  3.25it/s]generating response:   3%|▎         | 2/75 [00:00<00:18,  3.85it/s]generating response:   4%|▍         | 3/75 [00:00<00:17,  4.10it/s]generating response:   5%|▌         | 4/75 [00:01<00:20,  3.39it/s]generating response:   7%|▋         | 5/75 [00:01<00:22,  3.10it/s]generating response:   8%|▊         | 6/75 [00:01<00:23,  2.95it/s]generating response:   9%|▉         | 7/75 [00:02<00:27,  2.51it/s]generating response:  11%|█         | 8/75 [00:02<00:27,  2.43it/s]generating response:  12%|█▏        | 9/75 [00:03<00:24,  2.71it/s]generating response:  13%|█▎        | 10/75 [00:03<00:21,  3.09it/s]generating response:  15%|█▍        | 11/75 [00:03<00:21,  2.96it/s]generating response:  16%|█▌        | 12/75 [00:04<00:21,  2.93it/s]generating response:  17%|█▋        | 13/75 [00:19<04:58,  4.82s/it]generating response:  19%|█▊        | 14/75 [00:19<03:31,  3.47s/it]generating response:  20%|██        | 15/75 [00:19<02:30,  2.51s/it]generating response:  21%|██▏       | 16/75 [00:20<01:49,  1.86s/it]generating response:  23%|██▎       | 17/75 [00:20<01:22,  1.42s/it]generating response:  24%|██▍       | 18/75 [00:20<01:00,  1.06s/it]generating response:  25%|██▌       | 19/75 [00:21<00:47,  1.17it/s]generating response:  27%|██▋       | 20/75 [00:21<00:36,  1.51it/s]generating response:  28%|██▊       | 21/75 [00:22<00:46,  1.17it/s]generating response:  29%|██▉       | 22/75 [00:22<00:36,  1.47it/s]generating response:  31%|███       | 23/75 [00:23<00:28,  1.84it/s]generating response:  32%|███▏      | 24/75 [00:23<00:25,  2.03it/s]generating response:  33%|███▎      | 25/75 [00:23<00:20,  2.42it/s]generating response:  35%|███▍      | 26/75 [00:24<00:18,  2.59it/s]generating response:  36%|███▌      | 27/75 [00:24<00:17,  2.78it/s]generating response:  37%|███▋      | 28/75 [00:24<00:15,  3.00it/s]generating response:  39%|███▊      | 29/75 [00:24<00:14,  3.10it/s]generating response:  40%|████      | 30/75 [00:25<00:13,  3.42it/s]generating response:  41%|████▏     | 31/75 [00:25<00:12,  3.48it/s]generating response:  43%|████▎     | 32/75 [00:25<00:11,  3.72it/s]generating response:  44%|████▍     | 33/75 [00:26<00:16,  2.57it/s]generating response:  45%|████▌     | 34/75 [00:26<00:13,  2.94it/s]generating response:  47%|████▋     | 35/75 [00:27<00:21,  1.90it/s]generating response:  48%|████▊     | 36/75 [00:27<00:17,  2.29it/s]generating response:  49%|████▉     | 37/75 [00:42<03:03,  4.84s/it]generating response:  51%|█████     | 38/75 [00:57<04:53,  7.92s/it]generating response:  52%|█████▏    | 39/75 [00:58<03:22,  5.63s/it]generating response:  53%|█████▎    | 40/75 [00:58<02:20,  4.01s/it]generating response:  55%|█████▍    | 41/75 [00:59<01:42,  3.01s/it]generating response:  56%|█████▌    | 42/75 [01:14<03:39,  6.64s/it]generating response:  57%|█████▋    | 43/75 [01:14<02:32,  4.76s/it]generating response:  59%|█████▊    | 44/75 [01:15<01:46,  3.44s/it]generating response:  60%|██████    | 45/75 [01:15<01:14,  2.50s/it]generating response:  61%|██████▏   | 46/75 [01:15<00:53,  1.86s/it]generating response:  63%|██████▎   | 47/75 [01:16<00:39,  1.42s/it]generating response:  64%|██████▍   | 48/75 [01:16<00:30,  1.15s/it]generating response:  65%|██████▌   | 49/75 [01:16<00:22,  1.15it/s]generating response:  67%|██████▋   | 50/75 [01:18<00:24,  1.01it/s]generating response:  68%|██████▊   | 51/75 [01:18<00:18,  1.32it/s]generating response:  69%|██████▉   | 52/75 [01:18<00:13,  1.67it/s]generating response:  71%|███████   | 53/75 [01:18<00:11,  1.88it/s]generating response:  72%|███████▏  | 54/75 [01:19<00:09,  2.28it/s]generating response:  73%|███████▎  | 55/75 [01:19<00:08,  2.47it/s]generating response:  75%|███████▍  | 56/75 [01:19<00:07,  2.53it/s]generating response:  76%|███████▌  | 57/75 [01:20<00:06,  2.58it/s]generating response:  77%|███████▋  | 58/75 [01:20<00:06,  2.61it/s]generating response:  79%|███████▊  | 59/75 [01:20<00:05,  2.98it/s]generating response:  80%|████████  | 60/75 [01:21<00:05,  2.66it/s]generating response:  81%|████████▏ | 61/75 [01:21<00:04,  2.89it/s]generating response:  83%|████████▎ | 62/75 [01:21<00:04,  2.94it/s]generating response:  84%|████████▍ | 63/75 [01:22<00:03,  3.12it/s]generating response:  85%|████████▌ | 64/75 [01:22<00:03,  3.25it/s]generating response:  87%|████████▋ | 65/75 [01:22<00:02,  3.52it/s]generating response:  88%|████████▊ | 66/75 [01:22<00:02,  3.55it/s]generating response:  89%|████████▉ | 67/75 [01:23<00:02,  3.77it/s]generating response:  91%|█████████ | 68/75 [01:23<00:01,  3.95it/s]generating response:  92%|█████████▏| 69/75 [01:23<00:01,  4.08it/s]generating response:  93%|█████████▎| 70/75 [01:23<00:01,  3.52it/s]generating response:  95%|█████████▍| 71/75 [01:39<00:18,  4.73s/it]generating response:  96%|█████████▌| 72/75 [01:39<00:10,  3.40s/it]generating response:  97%|█████████▋| 73/75 [01:54<00:13,  6.91s/it]generating response:  99%|█████████▊| 74/75 [01:54<00:04,  4.97s/it]generating response: 100%|██████████| 75/75 [01:55<00:00,  3.54s/it]generating response: 100%|██████████| 75/75 [01:55<00:00,  1.54s/it]
generation part takes 135.15s
Full generation completed in 227.94s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:06<00:19,  3.25s/it] 38%|███▊      | 3/8 [00:12<00:22,  4.59s/it] 50%|█████     | 4/8 [00:19<00:21,  5.29s/it] 62%|██████▎   | 5/8 [00:25<00:17,  5.72s/it] 75%|███████▌  | 6/8 [00:32<00:11,  5.97s/it] 88%|████████▊ | 7/8 [00:39<00:06,  6.16s/it]100%|██████████| 8/8 [00:45<00:00,  6.25s/it]100%|██████████| 8/8 [00:45<00:00,  5.68s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.97it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.28it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.94it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.56it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Your device support faster inference by passing bf16=True in "AutoModelForCausalLM.from_pretrained".
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 76 images, 76 texts in 88.16s
Loading checkpoint shards:   0%|          | 0/10 [00:00<?, ?it/s]Loading checkpoint shards:  10%|█         | 1/10 [00:00<00:07,  1.21it/s]Loading checkpoint shards:  20%|██        | 2/10 [00:01<00:05,  1.59it/s]Loading checkpoint shards:  30%|███       | 3/10 [00:01<00:04,  1.64it/s]Loading checkpoint shards:  40%|████      | 4/10 [00:03<00:06,  1.11s/it]Loading checkpoint shards:  50%|█████     | 5/10 [00:05<00:06,  1.25s/it]Loading checkpoint shards:  60%|██████    | 6/10 [00:06<00:05,  1.35s/it]Loading checkpoint shards:  70%|███████   | 7/10 [00:07<00:03,  1.29s/it]Loading checkpoint shards:  80%|████████  | 8/10 [00:10<00:03,  1.55s/it]Loading checkpoint shards:  90%|█████████ | 9/10 [00:12<00:01,  1.72s/it]Loading checkpoint shards: 100%|██████████| 10/10 [00:13<00:00,  1.56s/it]Loading checkpoint shards: 100%|██████████| 10/10 [00:13<00:00,  1.34s/it]
generating response:   0%|          | 0/76 [00:00<?, ?it/s]generating response:   1%|▏         | 1/76 [00:02<02:59,  2.40s/it]generating response:   3%|▎         | 2/76 [00:03<02:08,  1.74s/it]generating response:   4%|▍         | 3/76 [00:04<01:51,  1.52s/it]generating response:   5%|▌         | 4/76 [00:06<01:59,  1.66s/it]generating response:   7%|▋         | 5/76 [00:10<02:54,  2.46s/it]generating response:   8%|▊         | 6/76 [00:14<03:31,  3.02s/it]generating response:   9%|▉         | 7/76 [00:16<03:01,  2.63s/it]generating response:  11%|█         | 8/76 [00:20<03:26,  3.03s/it]generating response:  12%|█▏        | 9/76 [00:33<06:44,  6.04s/it]generating response:  13%|█▎        | 10/76 [00:38<06:33,  5.96s/it]generating response:  14%|█▍        | 11/76 [00:40<04:51,  4.48s/it]generating response:  16%|█▌        | 12/76 [00:41<03:44,  3.51s/it]generating response:  17%|█▋        | 13/76 [00:42<02:58,  2.83s/it]generating response:  18%|█▊        | 14/76 [00:59<07:23,  7.15s/it]generating response:  20%|█▉        | 15/76 [01:01<05:29,  5.40s/it]generating response:  21%|██        | 16/76 [01:02<04:05,  4.09s/it]generating response:  22%|██▏       | 17/76 [01:03<03:12,  3.27s/it]generating response:  24%|██▎       | 18/76 [01:05<02:53,  3.00s/it]generating response:  25%|██▌       | 19/76 [01:07<02:22,  2.50s/it]generating response:  26%|██▋       | 20/76 [01:08<02:03,  2.20s/it]generating response:  28%|██▊       | 21/76 [01:10<01:48,  1.97s/it]generating response:  29%|██▉       | 22/76 [01:11<01:35,  1.77s/it]generating response:  30%|███       | 23/76 [01:13<01:38,  1.87s/it]generating response:  32%|███▏      | 24/76 [01:14<01:29,  1.72s/it]generating response:  33%|███▎      | 25/76 [01:16<01:22,  1.62s/it]generating response:  34%|███▍      | 26/76 [01:18<01:33,  1.86s/it]generating response:  36%|███▌      | 27/76 [01:20<01:26,  1.77s/it]generating response:  37%|███▋      | 28/76 [01:21<01:15,  1.57s/it]generating response:  38%|███▊      | 29/76 [01:23<01:16,  1.63s/it]generating response:  39%|███▉      | 30/76 [01:24<01:09,  1.51s/it]generating response:  41%|████      | 31/76 [01:25<01:05,  1.46s/it]generating response:  42%|████▏     | 32/76 [01:27<01:04,  1.47s/it]generating response:  43%|████▎     | 33/76 [01:29<01:17,  1.81s/it]generating response:  45%|████▍     | 34/76 [01:31<01:09,  1.66s/it]generating response:  46%|████▌     | 35/76 [01:32<01:03,  1.55s/it]generating response:  47%|████▋     | 36/76 [01:33<01:00,  1.50s/it]generating response:  49%|████▊     | 37/76 [01:35<00:58,  1.50s/it]generating response:  50%|█████     | 38/76 [01:36<00:57,  1.50s/it]generating response:  51%|█████▏    | 39/76 [01:38<00:53,  1.43s/it]generating response:  53%|█████▎    | 40/76 [01:39<00:49,  1.39s/it]generating response:  54%|█████▍    | 41/76 [01:41<00:50,  1.45s/it]generating response:  55%|█████▌    | 42/76 [01:42<00:50,  1.48s/it]generating response:  57%|█████▋    | 43/76 [01:43<00:44,  1.34s/it]generating response:  58%|█████▊    | 44/76 [01:44<00:42,  1.32s/it]generating response:  59%|█████▉    | 45/76 [01:46<00:41,  1.33s/it]generating response:  61%|██████    | 46/76 [01:47<00:41,  1.38s/it]generating response:  62%|██████▏   | 47/76 [01:49<00:40,  1.41s/it]generating response:  63%|██████▎   | 48/76 [01:50<00:38,  1.37s/it]generating response:  64%|██████▍   | 49/76 [01:51<00:36,  1.36s/it]generating response:  66%|██████▌   | 50/76 [01:53<00:35,  1.35s/it]generating response:  67%|██████▋   | 51/76 [01:54<00:34,  1.36s/it]generating response:  68%|██████▊   | 52/76 [01:55<00:32,  1.37s/it]generating response:  70%|██████▉   | 53/76 [01:58<00:38,  1.67s/it]generating response:  71%|███████   | 54/76 [01:59<00:35,  1.62s/it]generating response:  72%|███████▏  | 55/76 [02:01<00:33,  1.62s/it]generating response:  74%|███████▎  | 56/76 [02:02<00:31,  1.58s/it]generating response:  75%|███████▌  | 57/76 [02:04<00:28,  1.51s/it]generating response:  76%|███████▋  | 58/76 [02:05<00:28,  1.59s/it]generating response:  78%|███████▊  | 59/76 [02:07<00:27,  1.61s/it]generating response:  79%|███████▉  | 60/76 [02:11<00:34,  2.16s/it]generating response:  80%|████████  | 61/76 [02:12<00:27,  1.87s/it]generating response:  82%|████████▏ | 62/76 [02:13<00:24,  1.72s/it]generating response:  83%|████████▎ | 63/76 [02:16<00:25,  2.00s/it]generating response:  84%|████████▍ | 64/76 [02:17<00:21,  1.80s/it]generating response:  86%|████████▌ | 65/76 [02:19<00:18,  1.71s/it]generating response:  87%|████████▋ | 66/76 [02:25<00:32,  3.20s/it]generating response:  88%|████████▊ | 67/76 [02:29<00:30,  3.39s/it]generating response:  89%|████████▉ | 68/76 [02:33<00:27,  3.46s/it]generating response:  91%|█████████ | 69/76 [02:40<00:32,  4.68s/it]generating response:  92%|█████████▏| 70/76 [02:45<00:28,  4.77s/it]generating response:  93%|█████████▎| 71/76 [02:47<00:18,  3.79s/it]generating response:  95%|█████████▍| 72/76 [02:51<00:15,  3.80s/it]generating response:  96%|█████████▌| 73/76 [02:57<00:13,  4.53s/it]generating response:  97%|█████████▋| 74/76 [03:00<00:08,  4.04s/it]generating response:  99%|█████████▊| 75/76 [03:02<00:03,  3.62s/it]generating response: 100%|██████████| 76/76 [03:05<00:00,  3.34s/it]generating response: 100%|██████████| 76/76 [03:05<00:00,  2.44s/it]
generation part takes 214.17s
Full generation completed in 302.46s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:06<00:19,  3.24s/it] 38%|███▊      | 3/8 [00:12<00:22,  4.54s/it] 50%|█████     | 4/8 [00:19<00:20,  5.23s/it] 62%|██████▎   | 5/8 [00:25<00:17,  5.74s/it] 75%|███████▌  | 6/8 [00:32<00:11,  5.95s/it] 88%|████████▊ | 7/8 [00:38<00:06,  6.11s/it]100%|██████████| 8/8 [00:45<00:00,  6.23s/it]100%|██████████| 8/8 [00:45<00:00,  5.66s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  5.09it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.35it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  7.00it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.63it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Your device support faster inference by passing bf16=True in "AutoModelForCausalLM.from_pretrained".
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 75 images, 75 texts in 87.69s
Loading checkpoint shards:   0%|          | 0/10 [00:00<?, ?it/s]Loading checkpoint shards:  10%|█         | 1/10 [00:00<00:03,  2.43it/s]Loading checkpoint shards:  20%|██        | 2/10 [00:00<00:03,  2.32it/s]Loading checkpoint shards:  30%|███       | 3/10 [00:01<00:03,  1.87it/s]Loading checkpoint shards:  40%|████      | 4/10 [00:02<00:03,  1.66it/s]Loading checkpoint shards:  50%|█████     | 5/10 [00:02<00:03,  1.56it/s]Loading checkpoint shards:  60%|██████    | 6/10 [00:03<00:02,  1.51it/s]Loading checkpoint shards:  70%|███████   | 7/10 [00:04<00:02,  1.49it/s]Loading checkpoint shards:  80%|████████  | 8/10 [00:05<00:01,  1.47it/s]Loading checkpoint shards:  90%|█████████ | 9/10 [00:05<00:00,  1.49it/s]Loading checkpoint shards: 100%|██████████| 10/10 [00:06<00:00,  1.62it/s]Loading checkpoint shards: 100%|██████████| 10/10 [00:06<00:00,  1.62it/s]
generating response:   0%|          | 0/75 [00:00<?, ?it/s]generating response:   1%|▏         | 1/75 [00:03<04:19,  3.51s/it]generating response:   3%|▎         | 2/75 [00:05<03:10,  2.61s/it]generating response:   4%|▍         | 3/75 [00:07<02:57,  2.47s/it]generating response:   5%|▌         | 4/75 [00:09<02:38,  2.24s/it]generating response:   7%|▋         | 5/75 [00:11<02:27,  2.11s/it]generating response:   8%|▊         | 6/75 [00:13<02:16,  1.97s/it]generating response:   9%|▉         | 7/75 [00:16<02:42,  2.38s/it]generating response:  11%|█         | 8/75 [00:18<02:37,  2.35s/it]generating response:  12%|█▏        | 9/75 [00:20<02:17,  2.08s/it]generating response:  13%|█▎        | 10/75 [00:28<04:22,  4.04s/it]generating response:  15%|█▍        | 11/75 [00:33<04:30,  4.23s/it]generating response:  16%|█▌        | 12/75 [00:35<03:41,  3.52s/it]generating response:  17%|█▋        | 13/75 [00:39<03:59,  3.86s/it]generating response:  19%|█▊        | 14/75 [00:43<03:52,  3.81s/it]generating response:  20%|██        | 15/75 [00:49<04:25,  4.43s/it]generating response:  21%|██▏       | 16/75 [00:51<03:32,  3.60s/it]generating response:  23%|██▎       | 17/75 [00:52<02:48,  2.90s/it]generating response:  24%|██▍       | 18/75 [00:53<02:18,  2.43s/it]generating response:  25%|██▌       | 19/75 [00:55<01:56,  2.09s/it]generating response:  27%|██▋       | 20/75 [00:56<01:42,  1.86s/it]generating response:  28%|██▊       | 21/75 [00:57<01:34,  1.75s/it]generating response:  29%|██▉       | 22/75 [00:59<01:29,  1.69s/it]generating response:  31%|███       | 23/75 [01:00<01:25,  1.65s/it]generating response:  32%|███▏      | 24/75 [01:04<01:51,  2.19s/it]generating response:  33%|███▎      | 25/75 [01:06<01:40,  2.02s/it]generating response:  35%|███▍      | 26/75 [01:11<02:22,  2.91s/it]generating response:  36%|███▌      | 27/75 [01:14<02:33,  3.20s/it]generating response:  37%|███▋      | 28/75 [01:16<02:05,  2.66s/it]generating response:  39%|███▊      | 29/75 [01:17<01:47,  2.35s/it]generating response:  40%|████      | 30/75 [01:19<01:36,  2.14s/it]generating response:  41%|████▏     | 31/75 [01:21<01:35,  2.18s/it]generating response:  43%|████▎     | 32/75 [01:24<01:34,  2.20s/it]generating response:  44%|████▍     | 33/75 [01:28<01:58,  2.82s/it]generating response:  45%|████▌     | 34/75 [01:33<02:22,  3.47s/it]generating response:  47%|████▋     | 35/75 [01:37<02:30,  3.76s/it]generating response:  48%|████▊     | 36/75 [01:39<02:01,  3.11s/it]generating response:  49%|████▉     | 37/75 [01:48<03:05,  4.87s/it]generating response:  51%|█████     | 38/75 [01:54<03:09,  5.13s/it]generating response:  52%|█████▏    | 39/75 [01:58<02:57,  4.92s/it]generating response:  53%|█████▎    | 40/75 [02:03<02:50,  4.87s/it]generating response:  55%|█████▍    | 41/75 [02:04<02:10,  3.83s/it]generating response:  56%|█████▌    | 42/75 [02:06<01:42,  3.09s/it]generating response:  57%|█████▋    | 43/75 [02:08<01:29,  2.81s/it]generating response:  59%|█████▊    | 44/75 [02:10<01:24,  2.72s/it]generating response:  60%|██████    | 45/75 [02:18<02:10,  4.34s/it]generating response:  61%|██████▏   | 46/75 [02:25<02:26,  5.06s/it]generating response:  63%|██████▎   | 47/75 [02:30<02:22,  5.10s/it]generating response:  64%|██████▍   | 48/75 [02:33<01:59,  4.41s/it]generating response:  65%|██████▌   | 49/75 [02:36<01:40,  3.86s/it]generating response:  67%|██████▋   | 50/75 [02:38<01:27,  3.51s/it]generating response:  68%|██████▊   | 51/75 [02:40<01:08,  2.84s/it]generating response:  69%|██████▉   | 52/75 [02:45<01:20,  3.51s/it]generating response:  71%|███████   | 53/75 [02:49<01:23,  3.79s/it]generating response:  72%|███████▏  | 54/75 [02:51<01:05,  3.13s/it]generating response:  73%|███████▎  | 55/75 [02:54<01:05,  3.26s/it]generating response:  75%|███████▍  | 56/75 [03:02<01:26,  4.58s/it]generating response:  76%|███████▌  | 57/75 [03:04<01:08,  3.80s/it]generating response:  77%|███████▋  | 58/75 [03:09<01:12,  4.25s/it]generating response:  79%|███████▊  | 59/75 [03:11<00:56,  3.52s/it]generating response:  80%|████████  | 60/75 [03:15<00:53,  3.55s/it]generating response:  81%|████████▏ | 61/75 [03:21<01:02,  4.43s/it]generating response:  83%|████████▎ | 62/75 [03:25<00:56,  4.32s/it]generating response:  84%|████████▍ | 63/75 [03:28<00:48,  4.01s/it]generating response:  85%|████████▌ | 64/75 [03:33<00:44,  4.08s/it]generating response:  87%|████████▋ | 65/75 [03:34<00:32,  3.26s/it]generating response:  88%|████████▊ | 66/75 [03:35<00:24,  2.68s/it]generating response:  89%|████████▉ | 67/75 [03:37<00:18,  2.27s/it]generating response:  91%|█████████ | 68/75 [03:38<00:14,  2.12s/it]generating response:  92%|█████████▏| 69/75 [03:41<00:14,  2.34s/it]generating response:  93%|█████████▎| 70/75 [03:45<00:14,  2.85s/it]generating response:  95%|█████████▍| 71/75 [03:48<00:11,  2.85s/it]generating response:  96%|█████████▌| 72/75 [03:51<00:08,  2.83s/it]generating response:  97%|█████████▋| 73/75 [03:54<00:05,  2.97s/it]generating response:  99%|█████████▊| 74/75 [03:56<00:02,  2.47s/it]generating response: 100%|██████████| 75/75 [03:58<00:00,  2.37s/it]generating response: 100%|██████████| 75/75 [03:58<00:00,  3.18s/it]
generation part takes 262.32s
Full generation completed in 350.10s
processing images...   0%|          | 0/8 [00:00<?, ?it/s] 25%|██▌       | 2/8 [00:06<00:19,  3.24s/it] 38%|███▊      | 3/8 [00:12<00:22,  4.51s/it] 50%|█████     | 4/8 [00:19<00:20,  5.19s/it] 62%|██████▎   | 5/8 [00:25<00:17,  5.72s/it] 75%|███████▌  | 6/8 [00:32<00:11,  5.95s/it] 88%|████████▊ | 7/8 [00:38<00:06,  6.11s/it]100%|██████████| 8/8 [00:45<00:00,  6.21s/it]100%|██████████| 8/8 [00:45<00:00,  5.64s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  5.02it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  6.34it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.97it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.60it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
You are using the default legacy behaviour of the <class 'transformers.models.llama.tokenization_llama.LlamaTokenizer'>. This is expected, and simply means that the `legacy` (previous) behavior will be used so nothing changes for you. If you want to use the new behaviour, set `legacy=False`. This should only be set if you understand what it means, and thoroughly read the reason why this was added as explained in https://github.com/huggingface/transformers/pull/24565
csv file saved at: ./temp
Done
Defender initialized with threshold=-0.0005046081542968749
processed 75 images, 75 texts in 88.07s
Loading MiniGPT-4 models...Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:02<00:02,  2.38s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:03<00:00,  1.48s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:03<00:00,  1.61s/it]
Loading Q-Former
Loading Q-Former Done
Load MiniGPT-4 Checkpoint: /home/xuyue/QXYtemp/MLM/minigpt4/prerained_minigpt4_7b.pth
Done
generating response:   0%|          | 0/75 [00:00<?, ?it/s]generating response:   1%|▏         | 1/75 [00:36<45:15, 36.70s/it]generating response:   3%|▎         | 2/75 [01:15<45:59, 37.80s/it]generating response:   4%|▍         | 3/75 [01:50<44:08, 36.79s/it]generating response:   5%|▌         | 4/75 [02:28<43:51, 37.07s/it]generating response:   7%|▋         | 5/75 [03:05<43:05, 36.94s/it]generating response:   8%|▊         | 6/75 [03:41<42:28, 36.93s/it]generating response:   9%|▉         | 7/75 [04:18<41:41, 36.79s/it]generating response:  11%|█         | 8/75 [04:56<41:30, 37.17s/it]generating response:  12%|█▏        | 9/75 [05:34<41:14, 37.50s/it]generating response:  13%|█▎        | 10/75 [06:11<40:18, 37.20s/it]