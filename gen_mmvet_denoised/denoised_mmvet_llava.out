/home/xuyue/miniconda3/envs/llava/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/xuyue/miniconda3/envs/llava/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
processing images... denoise batch:   0%|          | 0/5 [00:00<?, ?it/s]denoise batch:  20%|██        | 1/5 [00:49<03:16, 49.02s/it]denoise batch:  40%|████      | 2/5 [01:38<02:27, 49.09s/it]denoise batch:  60%|██████    | 3/5 [02:27<01:38, 49.04s/it]denoise batch:  80%|████████  | 4/5 [03:15<00:48, 48.94s/it]denoise batch: 100%|██████████| 5/5 [03:27<00:00, 35.32s/it]denoise batch: 100%|██████████| 5/5 [03:27<00:00, 41.42s/it]
/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/configuration_llava.py:100: FutureWarning: The `vocab_size` argument is deprecated and will be removed in v4.42, since it can be inferred from the `text_config`. Passing this argument has no effect
  warnings.warn(
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.67it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  5.78it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.28it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.98it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/configuration_llava.py:100: FutureWarning: The `vocab_size` argument is deprecated and will be removed in v4.42, since it can be inferred from the `text_config`. Passing this argument has no effect
  warnings.warn(
csv file saved at: ./temp_llava
Done
Defender initialized with threshold=-0.003936767578125
processed 218 images, 218 texts in 314.82s
using llava for generation
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.00s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:01<00:00,  1.10it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.17it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.14it/s]
generating response:   0%|          | 0/218 [00:00<?, ?it/s]generating response:   0%|          | 1/218 [00:07<25:49,  7.14s/it]generating response:   1%|          | 2/218 [00:08<13:52,  3.85s/it]generating response:   1%|▏         | 3/218 [00:10<09:57,  2.78s/it]generating response:   2%|▏         | 4/218 [00:11<08:18,  2.33s/it]generating response:   2%|▏         | 5/218 [00:13<07:48,  2.20s/it]generating response:   3%|▎         | 6/218 [00:15<07:36,  2.15s/it]generating response:   3%|▎         | 7/218 [00:18<07:59,  2.27s/it]generating response:   4%|▎         | 8/218 [00:20<07:42,  2.20s/it]generating response:   4%|▍         | 9/218 [00:22<07:36,  2.18s/it]generating response:   5%|▍         | 10/218 [00:25<07:51,  2.27s/it]generating response:   5%|▌         | 11/218 [00:27<07:45,  2.25s/it]generating response:   6%|▌         | 12/218 [00:30<08:46,  2.56s/it]generating response:   6%|▌         | 13/218 [00:32<08:21,  2.45s/it]generating response:   6%|▋         | 14/218 [00:36<09:18,  2.74s/it]generating response:   7%|▋         | 15/218 [00:45<16:14,  4.80s/it]generating response:   7%|▋         | 16/218 [00:47<13:32,  4.02s/it]generating response:   8%|▊         | 17/218 [00:49<11:25,  3.41s/it]generating response:   8%|▊         | 18/218 [00:51<09:46,  2.93s/it]generating response:   9%|▊         | 19/218 [00:53<08:36,  2.60s/it]generating response:   9%|▉         | 20/218 [00:55<07:29,  2.27s/it]generating response:  10%|▉         | 21/218 [00:57<07:31,  2.29s/it]generating response:  10%|█         | 22/218 [00:59<07:28,  2.29s/it]generating response:  11%|█         | 23/218 [01:42<46:53, 14.43s/it]generating response:  11%|█         | 24/218 [01:44<34:21, 10.62s/it]generating response:  11%|█▏        | 25/218 [01:45<25:22,  7.89s/it]generating response:  12%|█▏        | 26/218 [01:47<19:43,  6.16s/it]generating response:  12%|█▏        | 27/218 [01:57<22:51,  7.18s/it]generating response:  13%|█▎        | 28/218 [01:59<17:34,  5.55s/it]generating response:  13%|█▎        | 29/218 [02:01<14:55,  4.74s/it]generating response:  14%|█▍        | 30/218 [02:03<12:18,  3.93s/it]generating response:  14%|█▍        | 31/218 [02:06<11:19,  3.64s/it]generating response:  15%|█▍        | 32/218 [02:08<09:20,  3.01s/it]generating response:  15%|█▌        | 33/218 [02:16<13:54,  4.51s/it]generating response:  16%|█▌        | 34/218 [02:22<14:55,  4.87s/it]generating response:  16%|█▌        | 35/218 [02:31<18:46,  6.16s/it]generating response:  17%|█▋        | 36/218 [02:33<15:09,  4.99s/it]generating response:  17%|█▋        | 37/218 [02:37<14:07,  4.68s/it]generating response:  17%|█▋        | 38/218 [02:43<15:28,  5.16s/it]generating response:  18%|█▊        | 39/218 [02:45<12:17,  4.12s/it]generating response:  18%|█▊        | 40/218 [02:49<11:56,  4.03s/it]generating response:  19%|█▉        | 41/218 [02:51<09:54,  3.36s/it]generating response:  19%|█▉        | 42/218 [02:53<08:32,  2.91s/it]generating response:  20%|█▉        | 43/218 [02:55<08:00,  2.74s/it]generating response:  20%|██        | 44/218 [02:56<06:55,  2.39s/it]generating response:  21%|██        | 45/218 [03:00<08:08,  2.83s/it]generating response:  21%|██        | 46/218 [03:05<10:02,  3.50s/it]generating response:  22%|██▏       | 47/218 [03:08<09:16,  3.26s/it]generating response:  22%|██▏       | 48/218 [03:11<08:48,  3.11s/it]generating response:  22%|██▏       | 49/218 [03:13<07:49,  2.78s/it]generating response:  23%|██▎       | 50/218 [03:15<07:10,  2.56s/it]generating response:  23%|██▎       | 51/218 [03:17<06:22,  2.29s/it]generating response:  24%|██▍       | 52/218 [03:18<05:48,  2.10s/it]generating response:  24%|██▍       | 53/218 [03:25<09:17,  3.38s/it]generating response:  25%|██▍       | 54/218 [03:26<07:21,  2.69s/it]generating response:  25%|██▌       | 55/218 [03:28<06:43,  2.48s/it]generating response:  26%|██▌       | 56/218 [03:30<06:23,  2.37s/it]generating response:  26%|██▌       | 57/218 [03:32<06:36,  2.46s/it]generating response:  27%|██▋       | 58/218 [03:36<07:08,  2.68s/it]generating response:  27%|██▋       | 59/218 [03:38<07:01,  2.65s/it]generating response:  28%|██▊       | 60/218 [03:40<06:26,  2.44s/it]generating response:  28%|██▊       | 61/218 [03:50<12:25,  4.75s/it]generating response:  28%|██▊       | 62/218 [03:52<10:02,  3.86s/it]generating response:  29%|██▉       | 63/218 [03:54<08:30,  3.29s/it]generating response:  29%|██▉       | 64/218 [03:56<07:25,  2.90s/it]generating response:  30%|██▉       | 65/218 [03:57<06:15,  2.46s/it]generating response:  30%|███       | 66/218 [03:59<05:29,  2.17s/it]generating response:  31%|███       | 67/218 [04:00<04:59,  1.98s/it]generating response:  31%|███       | 68/218 [04:02<04:46,  1.91s/it]generating response:  32%|███▏      | 69/218 [04:03<03:56,  1.59s/it]generating response:  32%|███▏      | 70/218 [04:05<04:08,  1.68s/it]generating response:  33%|███▎      | 71/218 [04:08<04:54,  2.01s/it]generating response:  33%|███▎      | 72/218 [04:09<04:39,  1.92s/it]generating response:  33%|███▎      | 73/218 [04:11<04:22,  1.81s/it]generating response:  34%|███▍      | 74/218 [04:13<04:17,  1.79s/it]generating response:  34%|███▍      | 75/218 [04:14<03:55,  1.65s/it]generating response:  35%|███▍      | 76/218 [04:16<03:50,  1.63s/it]generating response:  35%|███▌      | 77/218 [04:18<03:59,  1.70s/it]generating response:  36%|███▌      | 78/218 [04:20<04:12,  1.80s/it]generating response:  36%|███▌      | 79/218 [04:21<04:04,  1.76s/it]generating response:  37%|███▋      | 80/218 [04:23<04:00,  1.74s/it]generating response:  37%|███▋      | 81/218 [04:25<04:07,  1.80s/it]generating response:  38%|███▊      | 82/218 [04:27<04:31,  1.99s/it]generating response:  38%|███▊      | 83/218 [04:29<03:59,  1.78s/it]generating response:  39%|███▊      | 84/218 [04:30<03:37,  1.62s/it]generating response:  39%|███▉      | 85/218 [04:31<03:20,  1.51s/it]generating response:  39%|███▉      | 86/218 [04:32<03:04,  1.40s/it]generating response:  40%|███▉      | 87/218 [04:33<02:57,  1.36s/it]generating response:  40%|████      | 88/218 [04:35<03:02,  1.40s/it]generating response:  41%|████      | 89/218 [04:37<03:24,  1.59s/it]generating response:  41%|████▏     | 90/218 [04:39<03:21,  1.58s/it]generating response:  42%|████▏     | 91/218 [04:41<03:43,  1.76s/it]generating response:  42%|████▏     | 92/218 [04:43<03:56,  1.88s/it]generating response:  43%|████▎     | 93/218 [04:49<06:29,  3.12s/it]generating response:  43%|████▎     | 94/218 [04:56<08:59,  4.35s/it]generating response:  44%|████▎     | 95/218 [04:57<06:55,  3.38s/it]generating response:  44%|████▍     | 96/218 [04:59<05:57,  2.93s/it]generating response:  44%|████▍     | 97/218 [05:01<05:07,  2.54s/it]generating response:  45%|████▍     | 98/218 [05:03<04:40,  2.33s/it]generating response:  45%|████▌     | 99/218 [05:13<09:27,  4.77s/it]generating response:  46%|████▌     | 100/218 [05:30<16:23,  8.33s/it]generating response:  46%|████▋     | 101/218 [05:32<12:42,  6.52s/it]generating response:  47%|████▋     | 102/218 [05:36<11:04,  5.72s/it]generating response:  47%|████▋     | 103/218 [05:37<08:32,  4.46s/it]generating response:  48%|████▊     | 104/218 [05:39<06:45,  3.56s/it]generating response:  48%|████▊     | 105/218 [05:40<05:32,  2.94s/it]generating response:  49%|████▊     | 106/218 [05:41<04:24,  2.36s/it]generating response:  49%|████▉     | 107/218 [05:43<04:06,  2.22s/it]generating response:  50%|████▉     | 108/218 [05:45<03:49,  2.09s/it]generating response:  50%|█████     | 109/218 [05:46<03:22,  1.86s/it]generating response:  50%|█████     | 110/218 [05:48<03:00,  1.67s/it]generating response:  51%|█████     | 111/218 [05:50<03:38,  2.04s/it]generating response:  51%|█████▏    | 112/218 [05:51<02:58,  1.68s/it]generating response:  52%|█████▏    | 113/218 [05:52<02:30,  1.44s/it]generating response:  52%|█████▏    | 114/218 [05:55<03:05,  1.78s/it]generating response:  53%|█████▎    | 115/218 [05:57<03:15,  1.90s/it]generating response:  53%|█████▎    | 116/218 [05:58<02:41,  1.58s/it]generating response:  54%|█████▎    | 117/218 [05:59<02:39,  1.57s/it]generating response:  54%|█████▍    | 118/218 [06:00<02:16,  1.36s/it]generating response:  55%|█████▍    | 119/218 [06:01<02:11,  1.33s/it]generating response:  55%|█████▌    | 120/218 [06:03<02:17,  1.40s/it]generating response:  56%|█████▌    | 121/218 [06:05<02:28,  1.53s/it]generating response:  56%|█████▌    | 122/218 [06:07<02:32,  1.59s/it]generating response:  56%|█████▋    | 123/218 [06:08<02:38,  1.67s/it]generating response:  57%|█████▋    | 124/218 [06:09<02:13,  1.42s/it]generating response:  57%|█████▋    | 125/218 [06:11<02:33,  1.66s/it]generating response:  58%|█████▊    | 126/218 [06:12<02:10,  1.41s/it]generating response:  58%|█████▊    | 127/218 [06:14<02:21,  1.56s/it]generating response:  59%|█████▊    | 128/218 [06:16<02:22,  1.58s/it]generating response:  59%|█████▉    | 129/218 [06:18<02:24,  1.62s/it]generating response:  60%|█████▉    | 130/218 [06:20<02:32,  1.73s/it]generating response:  60%|██████    | 131/218 [06:22<02:48,  1.93s/it]generating response:  61%|██████    | 132/218 [06:24<02:44,  1.91s/it]generating response:  61%|██████    | 133/218 [06:25<02:33,  1.80s/it]generating response:  61%|██████▏   | 134/218 [06:27<02:35,  1.85s/it]generating response:  62%|██████▏   | 135/218 [06:30<02:41,  1.95s/it]generating response:  62%|██████▏   | 136/218 [06:30<02:13,  1.62s/it]generating response:  63%|██████▎   | 137/218 [06:32<02:13,  1.65s/it]generating response:  63%|██████▎   | 138/218 [06:34<02:07,  1.60s/it]generating response:  64%|██████▍   | 139/218 [06:35<02:01,  1.54s/it]generating response:  64%|██████▍   | 140/218 [06:41<03:49,  2.94s/it]generating response:  65%|██████▍   | 141/218 [06:48<05:10,  4.03s/it]generating response:  65%|██████▌   | 142/218 [06:51<04:53,  3.86s/it]generating response:  66%|██████▌   | 143/218 [06:57<05:43,  4.58s/it]generating response:  66%|██████▌   | 144/218 [07:01<05:23,  4.37s/it]generating response:  67%|██████▋   | 145/218 [07:10<06:46,  5.57s/it]generating response:  67%|██████▋   | 146/218 [07:11<05:05,  4.25s/it]generating response:  67%|██████▋   | 147/218 [07:17<05:37,  4.75s/it]generating response:  68%|██████▊   | 148/218 [07:23<06:04,  5.21s/it]generating response:  68%|██████▊   | 149/218 [07:32<07:14,  6.30s/it]generating response:  69%|██████▉   | 150/218 [07:40<07:46,  6.86s/it]generating response:  69%|██████▉   | 151/218 [07:48<07:58,  7.14s/it]generating response:  70%|██████▉   | 152/218 [07:54<07:27,  6.78s/it]generating response:  70%|███████   | 153/218 [08:02<07:41,  7.10s/it]generating response:  71%|███████   | 154/218 [08:09<07:35,  7.12s/it]generating response:  71%|███████   | 155/218 [08:15<07:15,  6.91s/it]generating response:  72%|███████▏  | 156/218 [08:27<08:32,  8.26s/it]generating response:  72%|███████▏  | 157/218 [08:36<08:39,  8.52s/it]generating response:  72%|███████▏  | 158/218 [08:44<08:17,  8.30s/it]generating response:  73%|███████▎  | 159/218 [09:00<10:40, 10.86s/it]generating response:  73%|███████▎  | 160/218 [09:07<09:13,  9.54s/it]generating response:  74%|███████▍  | 161/218 [09:24<11:13, 11.82s/it]generating response:  74%|███████▍  | 162/218 [09:37<11:19, 12.13s/it]generating response:  75%|███████▍  | 163/218 [09:49<11:04, 12.08s/it]generating response:  75%|███████▌  | 164/218 [10:32<19:09, 21.28s/it]generating response:  76%|███████▌  | 165/218 [10:44<16:19, 18.48s/it]generating response:  76%|███████▌  | 166/218 [10:54<13:59, 16.15s/it]generating response:  77%|███████▋  | 167/218 [11:09<13:15, 15.60s/it]generating response:  77%|███████▋  | 168/218 [11:23<12:36, 15.14s/it]generating response:  78%|███████▊  | 169/218 [11:24<09:06, 11.16s/it]generating response:  78%|███████▊  | 170/218 [11:31<07:50,  9.81s/it]generating response:  78%|███████▊  | 171/218 [11:33<05:51,  7.47s/it]generating response:  79%|███████▉  | 172/218 [11:37<04:57,  6.47s/it]generating response:  79%|███████▉  | 173/218 [11:42<04:29,  5.99s/it]generating response:  80%|███████▉  | 174/218 [11:47<04:12,  5.73s/it]generating response:  80%|████████  | 175/218 [11:49<03:16,  4.56s/it]generating response:  81%|████████  | 176/218 [11:51<02:40,  3.83s/it]generating response:  81%|████████  | 177/218 [11:53<02:13,  3.27s/it]generating response:  82%|████████▏ | 178/218 [12:00<02:51,  4.28s/it]generating response:  82%|████████▏ | 179/218 [12:06<03:07,  4.80s/it]generating response:  83%|████████▎ | 180/218 [12:13<03:33,  5.61s/it]generating response:  83%|████████▎ | 181/218 [12:19<03:27,  5.61s/it]generating response:  83%|████████▎ | 182/218 [12:27<03:43,  6.20s/it]generating response:  84%|████████▍ | 183/218 [12:35<04:05,  7.01s/it]generating response:  84%|████████▍ | 184/218 [12:43<03:59,  7.06s/it]generating response:  85%|████████▍ | 185/218 [12:50<03:53,  7.08s/it]generating response:  85%|████████▌ | 186/218 [12:56<03:34,  6.71s/it]generating response:  86%|████████▌ | 187/218 [13:02<03:24,  6.59s/it]generating response:  86%|████████▌ | 188/218 [13:09<03:26,  6.87s/it]generating response:  87%|████████▋ | 189/218 [13:18<03:30,  7.24s/it]generating response:  87%|████████▋ | 190/218 [13:29<03:55,  8.41s/it]generating response:  88%|████████▊ | 191/218 [13:43<04:31, 10.06s/it]generating response:  88%|████████▊ | 192/218 [13:51<04:07,  9.52s/it]generating response:  89%|████████▊ | 193/218 [14:02<04:10, 10.03s/it]generating response:  89%|████████▉ | 194/218 [14:12<04:00, 10.04s/it]generating response:  89%|████████▉ | 195/218 [14:21<03:40,  9.58s/it]generating response:  90%|████████▉ | 196/218 [14:28<03:15,  8.88s/it]generating response:  90%|█████████ | 197/218 [14:38<03:17,  9.39s/it]generating response:  91%|█████████ | 198/218 [14:52<03:30, 10.55s/it]generating response:  91%|█████████▏| 199/218 [14:57<02:49,  8.94s/it]generating response:  92%|█████████▏| 200/218 [15:00<02:11,  7.30s/it]generating response:  92%|█████████▏| 201/218 [15:02<01:36,  5.69s/it]generating response:  93%|█████████▎| 202/218 [15:07<01:26,  5.40s/it]generating response:  93%|█████████▎| 203/218 [15:18<01:47,  7.18s/it]generating response:  94%|█████████▎| 204/218 [15:22<01:23,  5.98s/it]generating response:  94%|█████████▍| 205/218 [15:25<01:07,  5.20s/it]generating response:  94%|█████████▍| 206/218 [15:28<00:54,  4.54s/it]generating response:  95%|█████████▍| 207/218 [15:32<00:48,  4.38s/it]generating response:  95%|█████████▌| 208/218 [15:35<00:38,  3.85s/it]generating response:  96%|█████████▌| 209/218 [15:50<01:06,  7.36s/it]generating response:  96%|█████████▋| 210/218 [16:08<01:24, 10.60s/it]generating response:  97%|█████████▋| 211/218 [16:35<01:48, 15.45s/it]generating response:  97%|█████████▋| 212/218 [16:49<01:29, 14.89s/it]generating response:  98%|█████████▊| 213/218 [17:29<01:52, 22.51s/it]generating response:  98%|█████████▊| 214/218 [17:58<01:38, 24.56s/it]generating response:  99%|█████████▊| 215/218 [18:21<01:11, 23.94s/it]generating response:  99%|█████████▉| 216/218 [18:38<00:44, 22.07s/it]generating response: 100%|█████████▉| 217/218 [18:49<00:18, 18.60s/it]generating response: 100%|██████████| 218/218 [19:12<00:00, 20.00s/it]generating response: 100%|██████████| 218/218 [19:12<00:00,  5.29s/it]
generation part takes 1163.26s
processing images... denoise batch:   0%|          | 0/5 [00:00<?, ?it/s]denoise batch:  20%|██        | 1/5 [00:48<03:12, 48.23s/it]denoise batch:  40%|████      | 2/5 [01:37<02:26, 48.69s/it]denoise batch:  60%|██████    | 3/5 [02:26<01:37, 48.84s/it]denoise batch:  80%|████████  | 4/5 [03:15<00:48, 48.89s/it]denoise batch: 100%|██████████| 5/5 [03:26<00:00, 35.31s/it]denoise batch: 100%|██████████| 5/5 [03:26<00:00, 41.29s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.46it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  5.58it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.07it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.77it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/configuration_llava.py:100: FutureWarning: The `vocab_size` argument is deprecated and will be removed in v4.42, since it can be inferred from the `text_config`. Passing this argument has no effect
  warnings.warn(
csv file saved at: ./temp_llava
Done
Defender initialized with threshold=-0.003936767578125
processed 218 images, 218 texts in 1792.05s
using llava for generation
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:01,  1.00it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:01<00:00,  1.03it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.12it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.09it/s]
generating response:   0%|          | 0/218 [00:00<?, ?it/s]generating response:   0%|          | 1/218 [00:05<20:56,  5.79s/it]generating response:   1%|          | 2/218 [00:07<11:20,  3.15s/it]generating response:   1%|▏         | 3/218 [00:08<08:13,  2.29s/it]generating response:   2%|▏         | 4/218 [00:09<06:53,  1.93s/it]generating response:   2%|▏         | 5/218 [00:11<06:29,  1.83s/it]generating response:   3%|▎         | 6/218 [00:13<06:18,  1.78s/it]generating response:   3%|▎         | 7/218 [00:15<06:38,  1.89s/it]generating response:   4%|▎         | 8/218 [00:16<06:26,  1.84s/it]generating response:   4%|▍         | 9/218 [00:18<06:22,  1.83s/it]generating response:   5%|▍         | 10/218 [00:20<06:39,  1.92s/it]generating response:   5%|▌         | 11/218 [00:22<06:32,  1.90s/it]generating response:   6%|▌         | 12/218 [00:25<07:21,  2.14s/it]generating response:   6%|▌         | 13/218 [00:27<07:09,  2.09s/it]generating response:   6%|▋         | 14/218 [00:30<07:51,  2.31s/it]generating response:   7%|▋         | 15/218 [00:38<13:32,  4.00s/it]generating response:   7%|▋         | 16/218 [00:40<11:19,  3.36s/it]generating response:   8%|▊         | 17/218 [00:41<09:31,  2.84s/it]generating response:   8%|▊         | 18/218 [00:43<08:10,  2.45s/it]generating response:   9%|▊         | 19/218 [00:44<07:13,  2.18s/it]generating response:   9%|▉         | 20/218 [00:46<06:18,  1.91s/it]generating response:  10%|▉         | 21/218 [00:48<06:39,  2.03s/it]generating response:  10%|█         | 22/218 [00:50<06:29,  1.99s/it]generating response:  11%|█         | 23/218 [01:25<38:55, 11.98s/it]generating response:  11%|█         | 24/218 [01:26<28:33,  8.83s/it]generating response:  11%|█▏        | 25/218 [01:28<21:06,  6.56s/it]generating response:  12%|█▏        | 26/218 [01:33<19:37,  6.13s/it]generating response:  12%|█▏        | 27/218 [01:41<21:13,  6.67s/it]generating response:  13%|█▎        | 28/218 [01:42<16:11,  5.12s/it]generating response:  13%|█▎        | 29/218 [01:45<13:30,  4.29s/it]generating response:  14%|█▍        | 30/218 [01:46<11:01,  3.52s/it]generating response:  14%|█▍        | 31/218 [01:49<10:00,  3.21s/it]generating response:  15%|█▍        | 32/218 [01:50<08:11,  2.64s/it]generating response:  15%|█▌        | 33/218 [01:57<11:47,  3.82s/it]generating response:  16%|█▌        | 34/218 [02:01<12:32,  4.09s/it]generating response:  16%|█▌        | 35/218 [02:09<15:40,  5.14s/it]generating response:  17%|█▋        | 36/218 [02:11<12:37,  4.16s/it]generating response:  17%|█▋        | 37/218 [02:14<11:46,  3.90s/it]generating response:  17%|█▋        | 38/218 [02:19<12:26,  4.15s/it]generating response:  18%|█▊        | 39/218 [02:20<09:56,  3.33s/it]generating response:  18%|█▊        | 40/218 [02:24<09:44,  3.29s/it]generating response:  19%|█▉        | 41/218 [02:25<08:07,  2.75s/it]generating response:  19%|█▉        | 42/218 [02:27<07:03,  2.41s/it]generating response:  20%|█▉        | 43/218 [02:29<06:38,  2.27s/it]generating response:  20%|██        | 44/218 [02:30<05:47,  2.00s/it]generating response:  21%|██        | 45/218 [02:32<06:03,  2.10s/it]generating response:  21%|██        | 46/218 [02:35<06:19,  2.21s/it]generating response:  22%|██▏       | 47/218 [02:37<06:20,  2.22s/it]generating response:  22%|██▏       | 48/218 [02:39<06:21,  2.25s/it]generating response:  22%|██▏       | 49/218 [02:41<05:50,  2.07s/it]generating response:  23%|██▎       | 50/218 [02:43<05:31,  1.97s/it]generating response:  23%|██▎       | 51/218 [02:44<05:00,  1.80s/it]generating response:  24%|██▍       | 52/218 [02:46<04:36,  1.67s/it]generating response:  24%|██▍       | 53/218 [02:51<07:33,  2.75s/it]generating response:  25%|██▍       | 54/218 [02:52<06:01,  2.21s/it]generating response:  25%|██▌       | 55/218 [02:53<05:31,  2.03s/it]generating response:  26%|██▌       | 56/218 [02:55<05:16,  1.96s/it]generating response:  26%|██▌       | 57/218 [02:57<05:28,  2.04s/it]generating response:  27%|██▋       | 58/218 [03:00<05:54,  2.22s/it]generating response:  27%|██▋       | 59/218 [03:02<05:51,  2.21s/it]generating response:  28%|██▊       | 60/218 [03:04<05:24,  2.05s/it]generating response:  28%|██▊       | 61/218 [03:05<04:57,  1.89s/it]generating response:  28%|██▊       | 62/218 [03:07<04:37,  1.78s/it]generating response:  29%|██▉       | 63/218 [03:08<04:19,  1.68s/it]generating response:  29%|██▉       | 64/218 [03:10<04:15,  1.66s/it]generating response:  30%|██▉       | 65/218 [03:11<03:54,  1.53s/it]generating response:  30%|███       | 66/218 [03:12<03:40,  1.45s/it]generating response:  31%|███       | 67/218 [03:14<03:33,  1.41s/it]generating response:  31%|███       | 68/218 [03:15<03:33,  1.43s/it]generating response:  32%|███▏      | 69/218 [03:16<03:01,  1.22s/it]generating response:  32%|███▏      | 70/218 [03:18<03:16,  1.33s/it]generating response:  33%|███▎      | 71/218 [03:20<03:57,  1.62s/it]generating response:  33%|███▎      | 72/218 [03:21<03:49,  1.57s/it]generating response:  33%|███▎      | 73/218 [03:23<03:35,  1.49s/it]generating response:  34%|███▍      | 74/218 [03:24<03:32,  1.48s/it]generating response:  34%|███▍      | 75/218 [03:25<03:14,  1.36s/it]generating response:  35%|███▍      | 76/218 [03:26<03:10,  1.34s/it]generating response:  35%|███▌      | 77/218 [03:28<03:20,  1.42s/it]generating response:  36%|███▌      | 78/218 [03:30<03:30,  1.50s/it]generating response:  36%|███▌      | 79/218 [03:31<03:26,  1.49s/it]generating response:  37%|███▋      | 80/218 [03:33<03:26,  1.50s/it]generating response:  37%|███▋      | 81/218 [03:34<03:30,  1.53s/it]generating response:  38%|███▊      | 82/218 [03:36<03:49,  1.69s/it]generating response:  38%|███▊      | 83/218 [03:37<03:21,  1.49s/it]generating response:  39%|███▊      | 84/218 [03:38<03:03,  1.37s/it]generating response:  39%|███▉      | 85/218 [03:40<02:49,  1.27s/it]generating response:  39%|███▉      | 86/218 [03:41<02:44,  1.25s/it]generating response:  40%|███▉      | 87/218 [03:42<02:37,  1.20s/it]generating response:  40%|████      | 88/218 [03:43<02:39,  1.22s/it]generating response:  41%|████      | 89/218 [03:45<02:56,  1.37s/it]generating response:  41%|████▏     | 90/218 [03:46<02:53,  1.35s/it]generating response:  42%|████▏     | 91/218 [03:48<03:10,  1.50s/it]generating response:  42%|████▏     | 92/218 [03:50<03:19,  1.58s/it]generating response:  43%|████▎     | 93/218 [03:55<05:25,  2.60s/it]generating response:  43%|████▎     | 94/218 [04:01<07:28,  3.61s/it]generating response:  44%|████▎     | 95/218 [04:02<05:45,  2.81s/it]generating response:  44%|████▍     | 96/218 [04:03<04:57,  2.44s/it]generating response:  44%|████▍     | 97/218 [04:05<04:17,  2.13s/it]generating response:  45%|████▍     | 98/218 [04:06<03:53,  1.95s/it]generating response:  45%|████▌     | 99/218 [04:15<07:49,  3.94s/it]generating response:  46%|████▌     | 100/218 [04:28<13:31,  6.88s/it]generating response:  46%|████▋     | 101/218 [04:30<10:30,  5.39s/it]generating response:  47%|████▋     | 102/218 [04:34<09:34,  4.95s/it]generating response:  47%|████▋     | 103/218 [04:36<07:22,  3.84s/it]generating response:  48%|████▊     | 104/218 [04:37<05:49,  3.07s/it]generating response:  48%|████▊     | 105/218 [04:38<04:45,  2.52s/it]generating response:  49%|████▊     | 106/218 [04:39<03:47,  2.03s/it]generating response:  49%|████▉     | 107/218 [04:41<03:30,  1.89s/it]generating response:  50%|████▉     | 108/218 [04:42<03:15,  1.78s/it]generating response:  50%|█████     | 109/218 [04:43<02:52,  1.59s/it]generating response:  50%|█████     | 110/218 [04:44<02:33,  1.42s/it]generating response:  51%|█████     | 111/218 [04:47<03:05,  1.73s/it]generating response:  51%|█████▏    | 112/218 [04:47<02:31,  1.43s/it]generating response:  52%|█████▏    | 113/218 [04:48<02:07,  1.21s/it]generating response:  52%|█████▏    | 114/218 [04:50<02:33,  1.48s/it]generating response:  53%|█████▎    | 115/218 [04:52<02:42,  1.58s/it]generating response:  53%|█████▎    | 116/218 [04:53<02:15,  1.32s/it]generating response:  54%|█████▎    | 117/218 [04:54<02:12,  1.32s/it]generating response:  54%|█████▍    | 118/218 [04:55<01:54,  1.14s/it]generating response:  55%|█████▍    | 119/218 [04:56<01:50,  1.12s/it]generating response:  55%|█████▌    | 120/218 [04:57<01:55,  1.17s/it]generating response:  56%|█████▌    | 121/218 [04:59<02:04,  1.28s/it]generating response:  56%|█████▌    | 122/218 [05:00<02:07,  1.33s/it]generating response:  56%|█████▋    | 123/218 [05:02<02:12,  1.40s/it]generating response:  57%|█████▋    | 124/218 [05:02<01:53,  1.20s/it]generating response:  57%|█████▋    | 125/218 [05:04<02:09,  1.40s/it]generating response:  58%|█████▊    | 126/218 [05:05<01:49,  1.19s/it]generating response:  58%|█████▊    | 127/218 [05:07<01:59,  1.32s/it]generating response:  59%|█████▊    | 128/218 [05:08<01:59,  1.33s/it]generating response:  59%|█████▉    | 129/218 [05:09<02:01,  1.37s/it]generating response:  60%|█████▉    | 130/218 [05:11<02:09,  1.47s/it]generating response:  60%|██████    | 131/218 [05:13<02:21,  1.62s/it]generating response:  61%|██████    | 132/218 [05:15<02:18,  1.61s/it]generating response:  61%|██████    | 133/218 [05:16<02:07,  1.50s/it]generating response:  61%|██████▏   | 134/218 [05:18<02:09,  1.54s/it]generating response:  62%|██████▏   | 135/218 [05:19<02:14,  1.62s/it]generating response:  62%|██████▏   | 136/218 [05:20<01:51,  1.36s/it]generating response:  63%|██████▎   | 137/218 [05:22<01:52,  1.39s/it]generating response:  63%|██████▎   | 138/218 [05:23<01:57,  1.47s/it]generating response:  64%|██████▍   | 139/218 [05:24<01:49,  1.39s/it]generating response:  64%|██████▍   | 140/218 [05:30<03:15,  2.51s/it]generating response:  65%|██████▍   | 141/218 [05:35<04:21,  3.39s/it]generating response:  65%|██████▌   | 142/218 [05:38<04:07,  3.26s/it]generating response:  66%|██████▌   | 143/218 [05:43<04:50,  3.88s/it]generating response:  66%|██████▌   | 144/218 [05:48<05:00,  4.06s/it]generating response:  67%|██████▋   | 145/218 [05:54<05:35,  4.60s/it]generating response:  67%|██████▋   | 146/218 [06:01<06:23,  5.33s/it]generating response:  67%|██████▋   | 147/218 [06:07<06:30,  5.50s/it]generating response:  68%|██████▊   | 148/218 [06:13<06:41,  5.74s/it]generating response:  68%|██████▊   | 149/218 [06:20<07:07,  6.20s/it]generating response:  69%|██████▉   | 150/218 [06:27<07:13,  6.38s/it]generating response:  69%|██████▉   | 151/218 [06:33<07:08,  6.40s/it]generating response:  70%|██████▉   | 152/218 [06:41<07:28,  6.80s/it]generating response:  70%|███████   | 153/218 [06:50<07:53,  7.29s/it]generating response:  71%|███████   | 154/218 [06:55<07:19,  6.86s/it]generating response:  71%|███████   | 155/218 [07:01<06:51,  6.53s/it]generating response:  72%|███████▏  | 156/218 [07:11<07:37,  7.38s/it]generating response:  72%|███████▏  | 157/218 [07:18<07:33,  7.43s/it]generating response:  72%|███████▏  | 158/218 [07:25<07:12,  7.21s/it]generating response:  73%|███████▎  | 159/218 [07:39<09:02,  9.20s/it]generating response:  73%|███████▎  | 160/218 [07:45<07:58,  8.25s/it]generating response:  74%|███████▍  | 161/218 [07:58<09:25,  9.93s/it]generating response:  74%|███████▍  | 162/218 [08:09<09:24, 10.09s/it]generating response:  75%|███████▍  | 163/218 [08:19<09:11, 10.03s/it]generating response:  75%|███████▌  | 164/218 [08:35<10:40, 11.86s/it]generating response:  76%|███████▌  | 165/218 [08:46<10:08, 11.48s/it]generating response:  76%|███████▌  | 166/218 [08:56<09:44, 11.24s/it]generating response:  77%|███████▋  | 167/218 [09:08<09:41, 11.41s/it]generating response:  77%|███████▋  | 168/218 [09:22<10:09, 12.20s/it]generating response:  78%|███████▊  | 169/218 [09:24<07:22,  9.03s/it]generating response:  78%|███████▊  | 170/218 [09:28<05:58,  7.47s/it]generating response:  78%|███████▊  | 171/218 [09:29<04:29,  5.74s/it]generating response:  79%|███████▉  | 172/218 [09:33<03:52,  5.05s/it]generating response:  79%|███████▉  | 173/218 [09:37<03:42,  4.93s/it]generating response:  80%|███████▉  | 174/218 [09:43<03:52,  5.29s/it]generating response:  80%|████████  | 175/218 [09:45<03:00,  4.19s/it]generating response:  81%|████████  | 176/218 [09:47<02:26,  3.49s/it]generating response:  81%|████████  | 177/218 [09:52<02:45,  4.04s/it]generating response:  82%|████████▏ | 178/218 [09:59<03:16,  4.91s/it]generating response:  82%|████████▏ | 179/218 [10:05<03:20,  5.14s/it]generating response:  83%|████████▎ | 180/218 [10:11<03:27,  5.46s/it]generating response:  83%|████████▎ | 181/218 [10:18<03:33,  5.78s/it]generating response:  83%|████████▎ | 182/218 [10:23<03:27,  5.77s/it]generating response:  84%|████████▍ | 183/218 [10:31<03:38,  6.25s/it]generating response:  84%|████████▍ | 184/218 [10:37<03:30,  6.19s/it]generating response:  85%|████████▍ | 185/218 [10:42<03:14,  5.89s/it]generating response:  85%|████████▌ | 186/218 [10:46<02:48,  5.26s/it]generating response:  86%|████████▌ | 187/218 [10:51<02:44,  5.30s/it]generating response:  86%|████████▌ | 188/218 [10:57<02:47,  5.58s/it]generating response:  87%|████████▋ | 189/218 [11:04<02:51,  5.91s/it]generating response:  87%|████████▋ | 190/218 [11:13<03:12,  6.88s/it]generating response:  88%|████████▊ | 191/218 [11:25<03:42,  8.26s/it]generating response:  88%|████████▊ | 192/218 [11:31<03:23,  7.83s/it]generating response:  89%|████████▊ | 193/218 [11:41<03:26,  8.25s/it]generating response:  89%|████████▉ | 194/218 [11:49<03:18,  8.27s/it]generating response:  89%|████████▉ | 195/218 [11:56<03:01,  7.88s/it]generating response:  90%|████████▉ | 196/218 [12:02<02:40,  7.32s/it]generating response:  90%|█████████ | 197/218 [12:11<02:42,  7.75s/it]generating response:  91%|█████████ | 198/218 [12:22<02:53,  8.69s/it]generating response:  91%|█████████▏| 199/218 [12:26<02:18,  7.27s/it]generating response:  92%|█████████▏| 200/218 [12:29<01:52,  6.25s/it]generating response:  92%|█████████▏| 201/218 [12:37<01:52,  6.64s/it]generating response:  93%|█████████▎| 202/218 [12:41<01:33,  5.82s/it]generating response:  93%|█████████▎| 203/218 [12:45<01:20,  5.37s/it]generating response:  94%|█████████▎| 204/218 [12:48<01:03,  4.56s/it]generating response:  94%|█████████▍| 205/218 [12:51<00:52,  4.03s/it]generating response:  94%|█████████▍| 206/218 [12:53<00:43,  3.61s/it]generating response:  95%|█████████▍| 207/218 [12:57<00:38,  3.52s/it]generating response:  95%|█████████▌| 208/218 [12:59<00:31,  3.12s/it]generating response:  96%|█████████▌| 209/218 [13:12<00:54,  6.02s/it]generating response:  96%|█████████▋| 210/218 [13:27<01:09,  8.71s/it]generating response:  97%|█████████▋| 211/218 [13:49<01:28, 12.71s/it]generating response:  97%|█████████▋| 212/218 [14:00<01:13, 12.24s/it]generating response:  98%|█████████▊| 213/218 [14:33<01:32, 18.51s/it]generating response:  98%|█████████▊| 214/218 [15:04<01:29, 22.31s/it]generating response:  99%|█████████▊| 215/218 [15:27<01:07, 22.39s/it]generating response:  99%|█████████▉| 216/218 [15:44<00:41, 20.94s/it]generating response: 100%|█████████▉| 217/218 [15:55<00:17, 17.81s/it]generating response: 100%|██████████| 218/218 [16:18<00:00, 19.45s/it]generating response: 100%|██████████| 218/218 [16:18<00:00,  4.49s/it]
generation part takes 987.81s
processing images... denoise batch:   0%|          | 0/5 [00:00<?, ?it/s]denoise batch:  20%|██        | 1/5 [00:48<03:14, 48.57s/it]denoise batch:  40%|████      | 2/5 [01:37<02:26, 48.84s/it]denoise batch:  60%|██████    | 3/5 [02:26<01:37, 48.98s/it]denoise batch:  80%|████████  | 4/5 [03:16<00:49, 49.10s/it]denoise batch: 100%|██████████| 5/5 [03:27<00:00, 35.41s/it]denoise batch: 100%|██████████| 5/5 [03:27<00:00, 41.43s/it]
Done
computing cossim... Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:00,  4.37it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:00<00:00,  5.54it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  6.08it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:00<00:00,  5.76it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/configuration_llava.py:100: FutureWarning: The `vocab_size` argument is deprecated and will be removed in v4.42, since it can be inferred from the `text_config`. Passing this argument has no effect
  warnings.warn(
csv file saved at: ./temp_llava
Done
Defender initialized with threshold=-0.003936767578125
processed 218 images, 218 texts in 3092.73s
using llava for generation
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:00<00:01,  1.01it/s]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:01<00:00,  1.12it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.24it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.19it/s]
generating response:   0%|          | 0/218 [00:00<?, ?it/s]generating response:   0%|          | 1/218 [00:05<20:58,  5.80s/it]generating response:   1%|          | 2/218 [00:07<11:22,  3.16s/it]generating response:   1%|▏         | 3/218 [00:08<08:11,  2.29s/it]generating response:   2%|▏         | 4/218 [00:09<06:53,  1.93s/it]generating response:   2%|▏         | 5/218 [00:11<06:28,  1.82s/it]generating response:   3%|▎         | 6/218 [00:13<06:19,  1.79s/it]generating response:   3%|▎         | 7/218 [00:15<06:39,  1.89s/it]generating response:   4%|▎         | 8/218 [00:16<06:25,  1.83s/it]generating response:   4%|▍         | 9/218 [00:18<06:20,  1.82s/it]generating response:   5%|▍         | 10/218 [00:20<06:34,  1.90s/it]generating response:   5%|▌         | 11/218 [00:22<06:42,  1.94s/it]generating response:   6%|▌         | 12/218 [00:25<07:27,  2.17s/it]generating response:   6%|▌         | 13/218 [00:27<07:16,  2.13s/it]generating response:   6%|▋         | 14/218 [00:30<07:57,  2.34s/it]generating response:   7%|▋         | 15/218 [00:38<13:36,  4.02s/it]generating response:   7%|▋         | 16/218 [00:40<11:21,  3.37s/it]generating response:   8%|▊         | 17/218 [00:41<09:33,  2.85s/it]generating response:   8%|▊         | 18/218 [00:43<08:11,  2.46s/it]generating response:   9%|▊         | 19/218 [00:44<07:14,  2.18s/it]generating response:   9%|▉         | 20/218 [00:46<06:18,  1.91s/it]generating response:  10%|▉         | 21/218 [00:48<06:18,  1.92s/it]generating response:  10%|█         | 22/218 [00:57<13:32,  4.14s/it]generating response:  11%|█         | 23/218 [00:59<11:24,  3.51s/it]generating response:  11%|█         | 24/218 [01:00<09:20,  2.89s/it]generating response:  11%|█▏        | 25/218 [01:02<07:44,  2.41s/it]generating response:  12%|█▏        | 26/218 [01:06<09:33,  2.99s/it]generating response:  12%|█▏        | 27/218 [01:14<14:11,  4.46s/it]generating response:  13%|█▎        | 28/218 [01:15<11:18,  3.57s/it]generating response:  13%|█▎        | 29/218 [01:18<10:04,  3.20s/it]generating response:  14%|█▍        | 30/218 [01:19<08:38,  2.76s/it]generating response:  14%|█▍        | 31/218 [01:22<08:18,  2.67s/it]generating response:  15%|█▍        | 32/218 [01:23<07:02,  2.27s/it]generating response:  15%|█▌        | 33/218 [01:30<10:59,  3.56s/it]generating response:  16%|█▌        | 34/218 [01:35<12:14,  3.99s/it]generating response:  16%|█▌        | 35/218 [01:42<15:24,  5.05s/it]generating response:  17%|█▋        | 36/218 [01:44<12:32,  4.14s/it]generating response:  17%|█▋        | 37/218 [01:48<11:42,  3.88s/it]generating response:  17%|█▋        | 38/218 [01:53<12:53,  4.30s/it]generating response:  18%|█▊        | 39/218 [01:54<10:17,  3.45s/it]generating response:  18%|█▊        | 40/218 [01:58<10:00,  3.37s/it]generating response:  19%|█▉        | 41/218 [01:59<08:19,  2.82s/it]generating response:  19%|█▉        | 42/218 [02:01<07:12,  2.45s/it]generating response:  20%|█▉        | 43/218 [02:03<06:45,  2.32s/it]generating response:  20%|██        | 44/218 [02:04<05:49,  2.01s/it]generating response:  21%|██        | 45/218 [02:06<06:06,  2.12s/it]generating response:  21%|██        | 46/218 [02:09<06:28,  2.26s/it]generating response:  22%|██▏       | 47/218 [02:11<06:25,  2.25s/it]generating response:  22%|██▏       | 48/218 [02:14<06:25,  2.27s/it]generating response:  22%|██▏       | 49/218 [02:15<05:53,  2.09s/it]generating response:  23%|██▎       | 50/218 [02:17<05:33,  1.99s/it]generating response:  23%|██▎       | 51/218 [02:18<05:00,  1.80s/it]generating response:  24%|██▍       | 52/218 [02:20<04:39,  1.68s/it]generating response:  24%|██▍       | 53/218 [02:25<07:33,  2.75s/it]generating response:  25%|██▍       | 54/218 [02:26<06:01,  2.21s/it]generating response:  25%|██▌       | 55/218 [02:28<05:31,  2.03s/it]generating response:  26%|██▌       | 56/218 [02:29<05:17,  1.96s/it]generating response:  26%|██▌       | 57/218 [02:32<05:28,  2.04s/it]generating response:  27%|██▋       | 58/218 [02:34<05:54,  2.22s/it]generating response:  27%|██▋       | 59/218 [02:36<05:50,  2.21s/it]generating response:  28%|██▊       | 60/218 [02:38<05:21,  2.03s/it]generating response:  28%|██▊       | 61/218 [02:39<04:54,  1.88s/it]generating response:  28%|██▊       | 62/218 [02:41<04:37,  1.78s/it]generating response:  29%|██▉       | 63/218 [02:43<04:30,  1.75s/it]generating response:  29%|██▉       | 64/218 [02:44<04:18,  1.68s/it]generating response:  30%|██▉       | 65/218 [02:45<03:54,  1.53s/it]generating response:  30%|███       | 66/218 [02:47<03:40,  1.45s/it]generating response:  31%|███       | 67/218 [02:48<03:32,  1.41s/it]generating response:  31%|███       | 68/218 [02:49<03:33,  1.43s/it]generating response:  32%|███▏      | 69/218 [02:50<03:00,  1.21s/it]generating response:  32%|███▏      | 70/218 [02:52<03:16,  1.33s/it]generating response:  33%|███▎      | 71/218 [02:54<03:58,  1.62s/it]generating response:  33%|███▎      | 72/218 [02:56<03:48,  1.56s/it]generating response:  33%|███▎      | 73/218 [02:57<03:48,  1.58s/it]generating response:  34%|███▍      | 74/218 [02:59<03:41,  1.54s/it]generating response:  34%|███▍      | 75/218 [03:00<03:22,  1.42s/it]generating response:  35%|███▍      | 76/218 [03:01<03:18,  1.39s/it]generating response:  35%|███▌      | 77/218 [03:03<03:24,  1.45s/it]generating response:  36%|███▌      | 78/218 [03:04<03:33,  1.52s/it]generating response:  36%|███▌      | 79/218 [03:06<03:27,  1.49s/it]generating response:  37%|███▋      | 80/218 [03:08<03:38,  1.58s/it]generating response:  37%|███▋      | 81/218 [03:09<03:39,  1.60s/it]generating response:  38%|███▊      | 82/218 [03:11<03:47,  1.67s/it]generating response:  38%|███▊      | 83/218 [03:12<03:22,  1.50s/it]generating response:  39%|███▊      | 84/218 [03:13<03:03,  1.37s/it]generating response:  39%|███▉      | 85/218 [03:14<02:49,  1.28s/it]generating response:  39%|███▉      | 86/218 [03:15<02:37,  1.20s/it]generating response:  40%|███▉      | 87/218 [03:16<02:30,  1.15s/it]generating response:  40%|████      | 88/218 [03:18<02:35,  1.19s/it]generating response:  41%|████      | 89/218 [03:19<02:54,  1.35s/it]generating response:  41%|████▏     | 90/218 [03:21<02:51,  1.34s/it]generating response:  42%|████▏     | 91/218 [03:22<03:09,  1.49s/it]generating response:  42%|████▏     | 92/218 [03:24<03:21,  1.60s/it]generating response:  43%|████▎     | 93/218 [03:29<05:26,  2.61s/it]generating response:  43%|████▎     | 94/218 [03:35<07:28,  3.62s/it]generating response:  44%|████▎     | 95/218 [03:37<05:57,  2.91s/it]generating response:  44%|████▍     | 96/218 [03:38<05:05,  2.51s/it]generating response:  44%|████▍     | 97/218 [03:39<04:23,  2.17s/it]generating response:  45%|████▍     | 98/218 [03:41<03:57,  1.98s/it]generating response:  45%|████▌     | 99/218 [03:50<07:51,  3.96s/it]generating response:  46%|████▌     | 100/218 [03:53<07:26,  3.78s/it]generating response:  46%|████▋     | 101/218 [03:55<06:16,  3.22s/it]generating response:  47%|████▋     | 102/218 [03:58<06:13,  3.22s/it]generating response:  47%|████▋     | 103/218 [03:59<05:04,  2.64s/it]generating response:  48%|████▊     | 104/218 [04:01<04:14,  2.23s/it]generating response:  48%|████▊     | 105/218 [04:02<03:38,  1.94s/it]generating response:  49%|████▊     | 106/218 [04:03<03:01,  1.62s/it]generating response:  49%|████▉     | 107/218 [04:04<02:58,  1.61s/it]generating response:  50%|████▉     | 108/218 [04:06<02:52,  1.57s/it]generating response:  50%|█████     | 109/218 [04:07<02:36,  1.44s/it]generating response:  50%|█████     | 110/218 [04:08<02:22,  1.32s/it]generating response:  51%|█████     | 111/218 [04:10<02:56,  1.65s/it]generating response:  51%|█████▏    | 112/218 [04:11<02:25,  1.38s/it]generating response:  52%|█████▏    | 113/218 [04:12<02:03,  1.18s/it]generating response:  52%|█████▏    | 114/218 [04:13<02:13,  1.29s/it]generating response:  53%|█████▎    | 115/218 [04:15<02:30,  1.46s/it]generating response:  53%|█████▎    | 116/218 [04:16<02:06,  1.24s/it]generating response:  54%|█████▎    | 117/218 [04:17<02:07,  1.26s/it]generating response:  54%|█████▍    | 118/218 [04:18<01:49,  1.10s/it]generating response:  55%|█████▍    | 119/218 [04:19<01:48,  1.09s/it]generating response:  55%|█████▌    | 120/218 [04:20<01:53,  1.16s/it]generating response:  56%|█████▌    | 121/218 [04:22<02:04,  1.28s/it]generating response:  56%|█████▌    | 122/218 [04:23<02:07,  1.33s/it]generating response:  56%|█████▋    | 123/218 [04:25<02:13,  1.40s/it]generating response:  57%|█████▋    | 124/218 [04:26<01:53,  1.21s/it]generating response:  57%|█████▋    | 125/218 [04:28<02:11,  1.41s/it]generating response:  58%|█████▊    | 126/218 [04:28<01:50,  1.20s/it]generating response:  58%|█████▊    | 127/218 [04:30<02:00,  1.33s/it]generating response:  59%|█████▊    | 128/218 [04:31<02:00,  1.34s/it]generating response:  59%|█████▉    | 129/218 [04:33<02:02,  1.37s/it]generating response:  60%|█████▉    | 130/218 [04:34<02:08,  1.46s/it]generating response:  60%|██████    | 131/218 [04:36<02:21,  1.63s/it]generating response:  61%|██████    | 132/218 [04:38<02:17,  1.60s/it]generating response:  61%|██████    | 133/218 [04:39<02:08,  1.51s/it]generating response:  61%|██████▏   | 134/218 [04:41<02:23,  1.70s/it]generating response:  62%|██████▏   | 135/218 [04:43<02:24,  1.74s/it]generating response:  62%|██████▏   | 136/218 [04:44<01:58,  1.44s/it]generating response:  63%|██████▎   | 137/218 [04:46<01:58,  1.46s/it]generating response:  63%|██████▎   | 138/218 [04:48<02:13,  1.67s/it]generating response:  64%|██████▍   | 139/218 [04:49<02:00,  1.53s/it]generating response:  64%|██████▍   | 140/218 [04:54<03:22,  2.60s/it]generating response:  65%|██████▍   | 141/218 [05:00<04:39,  3.62s/it]generating response:  65%|██████▌   | 142/218 [05:03<04:13,  3.34s/it]generating response:  66%|██████▌   | 143/218 [05:07<04:42,  3.76s/it]generating response:  66%|██████▌   | 144/218 [05:11<04:26,  3.60s/it]generating response:  67%|██████▋   | 145/218 [05:16<04:50,  3.97s/it]generating response:  67%|██████▋   | 146/218 [05:20<04:53,  4.08s/it]generating response:  67%|██████▋   | 147/218 [05:25<05:11,  4.39s/it]generating response:  68%|██████▊   | 148/218 [05:30<05:23,  4.63s/it]generating response:  68%|██████▊   | 149/218 [05:37<06:13,  5.41s/it]generating response:  69%|██████▉   | 150/218 [05:44<06:34,  5.80s/it]generating response:  69%|██████▉   | 151/218 [05:51<06:41,  6.00s/it]generating response:  70%|██████▉   | 152/218 [05:57<06:35,  6.00s/it]generating response:  70%|███████   | 153/218 [06:04<06:50,  6.32s/it]generating response:  71%|███████   | 154/218 [06:10<06:36,  6.19s/it]generating response:  71%|███████   | 155/218 [06:15<06:14,  5.94s/it]generating response:  72%|███████▏  | 156/218 [06:24<07:11,  6.97s/it]generating response:  72%|███████▏  | 157/218 [06:32<07:15,  7.13s/it]generating response:  72%|███████▏  | 158/218 [06:40<07:24,  7.41s/it]generating response:  73%|███████▎  | 159/218 [06:54<09:10,  9.34s/it]generating response:  73%|███████▎  | 160/218 [07:00<08:17,  8.58s/it]generating response:  74%|███████▍  | 161/218 [07:10<08:28,  8.92s/it]generating response:  74%|███████▍  | 162/218 [07:19<08:20,  8.94s/it]generating response:  75%|███████▍  | 163/218 [07:31<08:58,  9.78s/it]generating response:  75%|███████▌  | 164/218 [07:42<09:11, 10.22s/it]generating response:  76%|███████▌  | 165/218 [07:55<09:37, 10.89s/it]generating response:  76%|███████▌  | 166/218 [08:05<09:23, 10.84s/it]generating response:  77%|███████▋  | 167/218 [08:20<10:06, 11.89s/it]generating response:  77%|███████▋  | 168/218 [08:42<12:24, 14.90s/it]generating response:  78%|███████▊  | 169/218 [08:44<09:00, 11.02s/it]generating response:  78%|███████▊  | 170/218 [08:50<07:48,  9.76s/it]generating response:  78%|███████▊  | 171/218 [09:00<07:39,  9.77s/it]generating response:  79%|███████▉  | 172/218 [09:02<05:43,  7.48s/it]generating response:  79%|███████▉  | 173/218 [09:09<05:30,  7.34s/it]generating response:  80%|███████▉  | 174/218 [09:17<05:23,  7.36s/it]generating response:  80%|████████  | 175/218 [09:19<04:04,  5.69s/it]generating response:  81%|████████  | 176/218 [09:24<03:57,  5.65s/it]generating response:  81%|████████  | 177/218 [09:29<03:40,  5.38s/it]generating response:  82%|████████▏ | 178/218 [09:37<04:12,  6.31s/it]generating response:  82%|████████▏ | 179/218 [09:44<04:11,  6.45s/it]generating response:  83%|████████▎ | 180/218 [09:49<03:43,  5.89s/it]generating response:  83%|████████▎ | 181/218 [09:55<03:40,  5.96s/it]generating response:  83%|████████▎ | 182/218 [10:02<03:52,  6.44s/it]generating response:  84%|████████▍ | 183/218 [10:11<04:11,  7.19s/it]generating response:  84%|████████▍ | 184/218 [10:18<03:55,  6.92s/it]generating response:  85%|████████▍ | 185/218 [10:25<03:55,  7.13s/it]generating response:  85%|████████▌ | 186/218 [10:31<03:31,  6.60s/it]generating response:  86%|████████▌ | 187/218 [10:37<03:22,  6.52s/it]generating response:  86%|████████▌ | 188/218 [10:44<03:19,  6.64s/it]generating response:  87%|████████▋ | 189/218 [10:52<03:25,  7.08s/it]generating response:  87%|████████▋ | 190/218 [11:03<03:52,  8.29s/it]generating response:  88%|████████▊ | 191/218 [11:17<04:29, 10.00s/it]generating response:  88%|████████▊ | 192/218 [11:25<04:06,  9.49s/it]generating response:  89%|████████▊ | 193/218 [11:37<04:10, 10.01s/it]generating response:  89%|████████▉ | 194/218 [11:47<04:00, 10.03s/it]generating response:  89%|████████▉ | 195/218 [11:55<03:40,  9.58s/it]generating response:  90%|████████▉ | 196/218 [12:02<03:15,  8.89s/it]generating response:  90%|█████████ | 197/218 [12:13<03:17,  9.42s/it]generating response:  91%|█████████ | 198/218 [12:26<03:31, 10.59s/it]generating response:  91%|█████████▏| 199/218 [12:32<02:54,  9.19s/it]generating response:  92%|█████████▏| 200/218 [12:37<02:20,  7.78s/it]generating response:  92%|█████████▏| 201/218 [12:39<01:42,  6.06s/it]generating response:  93%|█████████▎| 202/218 [12:44<01:30,  5.66s/it]generating response:  93%|█████████▎| 203/218 [12:49<01:22,  5.53s/it]generating response:  94%|█████████▎| 204/218 [12:52<01:07,  4.83s/it]generating response:  94%|█████████▍| 205/218 [12:56<01:00,  4.63s/it]generating response:  94%|█████████▍| 206/218 [13:00<00:53,  4.45s/it]generating response:  95%|█████████▍| 207/218 [13:04<00:47,  4.32s/it]generating response:  95%|█████████▌| 208/218 [13:07<00:37,  3.80s/it]generating response:  96%|█████████▌| 209/218 [13:22<01:06,  7.34s/it]generating response:  96%|█████████▋| 210/218 [13:41<01:24, 10.59s/it]generating response:  97%|█████████▋| 211/218 [14:07<01:48, 15.48s/it]generating response:  97%|█████████▋| 212/218 [14:21<01:29, 14.90s/it]generating response:  98%|█████████▊| 213/218 [15:01<01:52, 22.53s/it]generating response:  98%|█████████▊| 214/218 [15:44<01:54, 28.65s/it]generating response:  99%|█████████▊| 215/218 [16:12<01:24, 28.27s/it]generating response:  99%|█████████▉| 216/218 [16:33<00:52, 26.24s/it]generating response: 100%|█████████▉| 217/218 [16:46<00:22, 22.17s/it]generating response: 100%|██████████| 218/218 [17:14<00:00, 24.03s/it]generating response: 100%|██████████| 218/218 [17:14<00:00,  4.75s/it]
generation part takes 1042.82s
Full generation completed in 4135.60s
/home/xuyue/miniconda3/envs/llava/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/xuyue/miniconda3/envs/llava/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/configuration_llava.py:100: FutureWarning: The `vocab_size` argument is deprecated and will be removed in v4.42, since it can be inferred from the `text_config`. Passing this argument has no effect
  warnings.warn(
processed 218 images, 218 texts in 0.10s
using llava for generation
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:01<00:02,  1.09s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:02<00:00,  1.01it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.09it/s]Loading checkpoint shards: 100%|██████████| 3/3 [00:02<00:00,  1.06it/s]
generating response:   0%|          | 0/218 [00:00<?, ?it/s]generating response:   0%|          | 0/218 [00:01<?, ?it/s]
Traceback (most recent call last):
  File "/home/xuyue/QXYtemp/MLM/./main.py", line 102, in <module>
    responses = get_response(args.model, texts, images, a=a)
  File "/home/xuyue/QXYtemp/MLM/model_tools.py", line 313, in get_response
    output = model.generate(**input,max_new_tokens=512) # type: ignore
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/generation/utils.py", line 1758, in generate
    result = self._sample(
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/generation/utils.py", line 2397, in _sample
    outputs = self(
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llava/modeling_llava.py", line 476, in forward
    outputs = self.language_model(
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llama/modeling_llama.py", line 1164, in forward
    outputs = self.model(
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llama/modeling_llama.py", line 968, in forward
    layer_outputs = decoder_layer(
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llama/modeling_llama.py", line 713, in forward
    hidden_states, self_attn_weights, present_key_value = self.self_attn(
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/models/llama/modeling_llama.py", line 629, in forward
    key_states, value_states = past_key_value.update(key_states, value_states, self.layer_idx, cache_kwargs)
  File "/home/xuyue/.local/lib/python3.10/site-packages/transformers/cache_utils.py", line 156, in update
    self.value_cache[layer_idx] = torch.cat([self.value_cache[layer_idx], value_states], dim=-2)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 20.00 MiB. GPU  has a total capacity of 44.35 GiB of which 17.31 MiB is free. Process 826391 has 7.01 GiB memory in use. Including non-PyTorch memory, this process has 27.78 GiB memory in use. Process 828719 has 9.51 GiB memory in use. Of the allocated memory 27.14 GiB is allocated by PyTorch, and 331.89 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
-------llava with defence generation complete-------
-------llava without defence generation complete-------
